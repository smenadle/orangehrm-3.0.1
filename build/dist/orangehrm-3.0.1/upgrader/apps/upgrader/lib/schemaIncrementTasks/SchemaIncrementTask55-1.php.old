<?php

/**
 * OrangeHRM is a comprehensive Human Resource Management (HRM) System that captures
 * all the essential functionalities required for any enterprise.
 * Copyright (C) 2006 OrangeHRM Inc., http://www.orangehrm.com
 *
 * OrangeHRM is free software; you can redistribute it and/or modify it under the terms of
 * the GNU General Public License as published by the Free Software Foundation; either
 * version 2 of the License, or (at your option) any later version.
 *
 * OrangeHRM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program;
 * if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 * Boston, MA  02110-1301, USA
 *
 */

/**
 * Upgrade for menu changes, new ui changes and leave changes:
 * 
 * TODO: Improve
 * **************** IMPORTANT *********************
 * UPGRADE IS NOT ONLY COMPATIBLE WITH A PLAIN OS INSTALL.
 * If ab addon is installed, those add-ons may
 * have added records to ohrm_user_role and related tables. Therefore, the SQL in 
 * here has to be improved to not hard code IDs.
 * 
 * For an example, see: rangehrmRegionalAdminAuthorizationPlugin/trunk/install/dbscript.sql
 * ******************************************************
 */
class SchemaIncrementTask55 extends SchemaIncrementTask {
    public $userInputs;

    public function execute() {
        $this->incrementNumber = 55;
        parent::execute();

        $result = array();

        foreach ($this->sql as $sql) {
            $result[] = $this->upgradeUtility->executeSql($sql);
        }

        $this->checkTransactionComplete($result);
        $this->updateOhrmUpgradeInfo($this->transactionComplete, $this->incrementNumber);
        $this->upgradeUtility->finalizeTransaction($this->transactionComplete);
        $this->upgradeUtility->closeDbConnection();
    }

    public function getUserInputWidgets() {
        
    }

    public function setUserInputs() {
        
    }

    public function loadSql() {

	/* upgrade from 2.7.1rc1 to 2.7.1 - by Emma */
        $sql[] = "UPDATE `hs_hr_config` SET `value` = 'en_US' WHERE `key` = 'admin.localization.default_language';";

        $sql[] = "UPDATE `ohrm_display_field` SET `label`='Eligibility Status' WHERE `display_field_id` = 87;";

        $sql[] = "UPDATE `ohrm_display_field` SET `label`='Eligibility Review Date' WHERE `display_field_id` = 89;";

	/* upgrade from 2.7.1rc1 to 2.7.1 - by Emma - ends */

        
        
        /* ruchira part */
        $sql[] = "create table `ohrm_menu_item` (
                    `id` int not null auto_increment, 
                    `menu_title` varchar(255) not null, 
                    `screen_id` int default null,
                    `parent_id` int default null,
                    `level` tinyint not null,
                    `order_hint` int not null,
                    `url_extras` varchar(255) default null, 
                    `status` tinyint not null default 1,
                    primary key (`id`)
                 ) engine=innodb default charset=utf8;";
        
        $sql[] = "CREATE TABLE ohrm_leave_type (
                `id` int unsigned not null auto_increment,
                `name` varchar(50) not null,
                `deleted` tinyint(1) not null default 0,
                `operational_country_id` int unsigned default null,
                primary key  (`id`)
              ) engine=innodb default charset=utf8;";

        //changed by Emma
        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_entitlement` (
                `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
                `emp_number` int(7) NOT NULL,
                `no_of_days` decimal(6,2) NOT NULL,
                `days_used` decimal(4,2) NOT NULL DEFAULT '0.00',
                `leave_type_id` int(10) unsigned NOT NULL,
                `from_date` datetime NOT NULL,
                `to_date` datetime DEFAULT NULL,
                `credited_date` datetime DEFAULT NULL,
                `note` varchar(255) DEFAULT NULL,
                `entitlement_type` int(10) unsigned NOT NULL,
                `deleted` tinyint(1) NOT NULL DEFAULT '0',
                `created_by_id` int(10) DEFAULT NULL,
                `created_by_name` varchar(255) DEFAULT NULL,
                PRIMARY KEY (`id`),
                KEY `leave_type_id` (`leave_type_id`),
                KEY `emp_number` (`emp_number`),
                KEY `entitlement_type` (`entitlement_type`),
                KEY `created_by_id` (`created_by_id`)
              ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";

        $sql[] = "CREATE TABLE `ohrm_leave_request` (
                    `id` int unsigned NOT NULL auto_increment,
                    `leave_type_id` int unsigned NOT NULL,
                    `date_applied` date NOT NULL,
                    `emp_number` int(7) NOT NULL,
                    `comments` varchar(256) default NULL,
                    PRIMARY KEY  (`id`)
                  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";

        $sql[] = "CREATE TABLE `ohrm_leave` (
                    `id` int(11) NOT NULL  auto_increment,
                    `date` date default NULL,
                    `length_hours` decimal(6,2) unsigned default NULL,
                    `length_days` decimal(4,2) unsigned default NULL,
                    `status` smallint(6) default NULL,
                    `comments` varchar(256) default NULL,
                    `leave_request_id`int unsigned NOT NULL,
                    `leave_type_id` int unsigned NOT NULL,
                    `emp_number` int(7) NOT NULL,
                    `start_time` time default NULL,
                    `end_time` time default NULL,
                    PRIMARY KEY  (`id`),
                    KEY `leave_request_type_emp`(`leave_request_id`,`leave_type_id`,`emp_number`),
                    KEY `request_status` (`leave_request_id`,`status`)
                  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
    
        $sql[] = "create TABLE `ohrm_leave_leave_entitlement` (
                `id` int(11) NOT NULL   auto_increment,
                `leave_id` int(11) NOT NULL,
                `entitlement_id` int unsigned NOT NULL,
                `length_days` decimal(4,2) unsigned default NULL,
                PRIMARY KEY  (`id`)
            ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
        
        
         $sql[] = "CREATE TABLE `ohrm_leave_period` (
                    `leave_period_id` int(11) NOT NULL,
                    `leave_period_start_date` date NOT NULL,
                    `leave_period_end_date` date NOT NULL,
                    PRIMARY KEY (`leave_period_id`)
                  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
        
        $sql[] = "alter table ohrm_leave_type
                add foreign key (operational_country_id)
                    references ohrm_operational_country(id) on delete set null;";
        //commented & changed by Emma
        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_entitlement_type` (
                  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
                  `name` varchar(50) NOT NULL,
                  `is_editable` tinyint(1) NOT NULL DEFAULT '0',
                   PRIMARY KEY (`id`)
                  ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;";

        $sql[] = "INSERT INTO `ohrm_leave_entitlement_type` (`id`, `name`, `is_editable`) VALUES
                    (1, 'Added', 1);";

//        $sql[] = "alter table ohrm_leave_entitlement
//                add foreign key (leave_type_id)
//                    references ohrm_leave_type(id) on delete cascade;";
//
//        $sql[] = "alter table ohrm_leave_entitlement
//                    add foreign key (emp_number)
//                        references hs_hr_employee(emp_number) on delete cascade;";
//
//        $sql[] = "alter table ohrm_leave_entitlement
//            add foreign key (created_by_id)
//                references ohrm_user(`id`) on delete set null;";

        $sql[] = "ALTER TABLE `ohrm_leave_entitlement`
  ADD CONSTRAINT `ohrm_leave_entitlement_ibfk_1` FOREIGN KEY (`leave_type_id`) REFERENCES `ohrm_leave_type` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `ohrm_leave_entitlement_ibfk_2` FOREIGN KEY (`emp_number`) REFERENCES `hs_hr_employee` (`emp_number`) ON DELETE CASCADE,
  ADD CONSTRAINT `ohrm_leave_entitlement_ibfk_3` FOREIGN KEY (`entitlement_type`) REFERENCES `ohrm_leave_entitlement_type` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `ohrm_leave_entitlement_ibfk_4` FOREIGN KEY (`created_by_id`) REFERENCES `ohrm_user` (`id`) ON DELETE SET NULL;";
        $sql[] = "alter table ohrm_leave_request
            add constraint foreign key (emp_number)
                references hs_hr_employee (emp_number) on delete cascade;";

        $sql[] = "alter table ohrm_leave_request
            add constraint foreign key (leave_type_id)
                references ohrm_leave_type (id) on delete cascade;";

        $sql[] = "alter table ohrm_leave
            add foreign key (leave_request_id)
                references ohrm_leave_request(id) on delete cascade;";

        $sql[] = "alter table ohrm_leave
            add constraint foreign key (leave_type_id)
                references ohrm_leave_type (id) on delete cascade";

        $sql[] = "alter table ohrm_leave
            add constraint foreign key (leave_type_id)
                references ohrm_leave_type (id) on delete cascade";

        $sql[] = "alter table ohrm_leave_leave_entitlement
            add constraint foreign key (entitlement_id)
                references ohrm_leave_entitlement (id) on delete cascade";

        $sql[] = "alter table ohrm_leave_leave_entitlement
            add constraint foreign key (leave_id)
                references ohrm_leave (id) on delete cascade";


        $sql[] = "alter table ohrm_menu_item 
               add constraint foreign key (screen_id)
                                     references ohrm_screen(id) on delete cascade;";        

        $sql[] = "INSERT INTO `hs_hr_config`(`key`, `value`) VALUES ('themeName', 'default'),
                    ('leave.entitlement_consumption_algorithm', 'FIFOEntitlementConsumptionStrategy'),
                    ('leave.work_schedule_implementation', 'BasicWorkSchedule');";
        
        $sql[] = "DELETE FROM `ohrm_user_role` WHERE id = 6;";
        
        $sql[] = "INSERT INTO `ohrm_user_role` (`id`, `name`, `display_name`, `is_assignable`, `is_predefined`) VALUES
                (6, 'HiringManager', 'HiringManager', 0, 1),
                (7, 'Reviewer', 'Reviewer', 0, 1);";


        $sql[] = "INSERT INTO ohrm_screen (`id`, `name`, `module_id`, `action_url`) VALUES
                    (20, 'General Information', 2, 'viewOrganizationGeneralInformation'),
                    (21, 'Location List', 2, 'viewLocations'),
                    (22, 'View Company Structure', 2, 'viewCompanyStructure'),
                    (23, 'Job Title List', 2, 'viewJobTitleList'),
                    (24, 'Pay Grade List', 2, 'viewPayGrades'),
                    (25, 'Employment Status List', 2, 'employmentStatus'),
                    (26, 'Job Category List', 2, 'jobCategory'),
                    (27, 'Work Shift List', 2, 'workShift'),
                    (28, 'Skill List', 2, 'viewSkills'),
                    (29, 'Education List', 2, 'viewEducation'),
                    (30, 'License List', 2, 'viewLicenses'),
                    (31, 'Language List', 2, 'viewLanguages'),
                    (32, 'Membership List', 2, 'membership'),
                    (33, 'Nationality List', 2, 'nationality'),
                    (34, 'Add/Edit Mail Configuration', 2, 'listMailConfiguration'),
                    (35, 'Notification List', 2, 'viewEmailNotification'),
                    (36, 'Customer List', 2, 'viewCustomers'),
                    (37, 'Project List', 2, 'viewProjects'),
                    (38, 'Localization', 2, 'localization'),
                    (39, 'Module Configuration', 2, 'viewModules'),
                    (40, 'Configure PIM', 3, 'configurePim'),
                    (41, 'Custom Field List', 3, 'listCustomFields'),
                    (42, 'Data Import', 2, 'pimCsvImport'),
                    (43, 'Reporting Method List', 3, 'viewReportingMethods'),
                    (44, 'Termination Reason List', 3, 'viewTerminationReasons'),
                    (45, 'PIM Reports List', 1, 'viewDefinedPredefinedReports'),
                    (46, 'View MyInfo', 3, 'viewMyDetails'),
                    (47, 'Define Leave Period', 4, 'defineLeavePeriod'),
                    (48, 'View My Leave List', 4, 'viewMyLeaveList'),
                    (49, 'Apply Leave', 4, 'applyLeave'),
                    (50, 'Define Timesheet Start Date', 5, 'defineTimesheetPeriod'),
                    (51, 'View My Timesheet', 5, 'viewMyTimesheet'),
                    (52, 'View Employee Timesheet', 5, 'viewEmployeeTimesheet'),
                    (53, 'View My Attendance', 6, 'viewMyAttendanceRecord'),
                    (54, 'Punch In/Out', 6, 'punchIn'),
                    (55, 'View Employee Attendance', 6, 'viewAttendanceRecord'),
                    (56, 'Attendance Configuration', 6, 'configure'),
                    (57, 'View Employee Report Criteria', 5, 'displayProjectReportCriteria'),
                    (58, 'View Project Report Criteria', 5, 'displayEmployeeReportCriteria'),
                    (59, 'View Attendance Report Criteria', 5, 'displayAttendanceSummaryReportCriteria'),
                    (60, 'Candidate List', 7, 'viewCandidates'),
                    (61, 'Vacancy List', 7, 'viewJobVacancy'),
                    (62, 'KPI List', 9, 'listDefineKpi'),
                    (63, 'Add/Edit KPI', 9, 'saveKpi'),
                    (64, 'Copy KPI', 9, 'copyKpi'),
                    (65, 'Add Review', 9, 'saveReview'),
                    (66, 'Review List', 9, 'viewReview'),
                    (67, 'View Time Module', 5, 'viewTimeModule'),
                    (68, 'View Leave Module', 4, 'viewLeaveModule'),
                    (69, 'Leave Entitlements', 4, 'viewLeaveEntitlements'),
                    (70, 'My Leave Entitlements', 4, 'viewMyLeaveEntitlements'),
                    (71, 'Delete Leave Entitlements', 4, 'deleteLeaveEntitlements'),
                    (72, 'Add Leave Entitlement', 4, 'addLeaveEntitlement'),
                    (73, 'Edit Leave Entitlement', 4, 'editLeaveEntitlement'),
                    (74, 'View Admin Module', 2, 'viewAdminModule'),
                    (75, 'View PIM Module', 3, 'viewPimModule'),
                    (76, 'View Recruitment Module', 7, 'viewRecruitmentModule'),
                    (77, 'View Performance Module', 9, 'viewPerformanceModule'),
                    (78, 'Leave Balance Report', 4, 'viewLeaveBalanceReport'),
                    (79, 'My Leave Balance Report', 4, 'viewMyLeaveBalanceReport');";

        //changed by Emma
        $sql[] = "INSERT INTO `ohrm_menu_item` (`id`, `menu_title`, `screen_id`, `parent_id`, `level`, `order_hint`, `url_extras`, `status`) VALUES
(1, 'Admin', 74, NULL, 1, 100, NULL, 1),
(2, 'User Management', NULL, 1, 2, 100, NULL, 1),
(3, 'Project Info', NULL, 52, 2, 400, NULL, 0),
(4, 'Customers', 36, 3, 3, 100, NULL, 1),
(5, 'Projects', 37, 3, 3, 200, NULL, 1),
(6, 'Job', NULL, 1, 2, 300, NULL, 1),
(7, 'Job Titles', 23, 6, 3, 100, NULL, 1),
(8, 'Pay Grades', 24, 6, 3, 200, NULL, 1),
(9, 'Employment Status', 25, 6, 3, 300, NULL, 1),
(10, 'Job Categories', 26, 6, 3, 400, NULL, 1),
(11, 'Work Shifts', 27, 6, 3, 500, NULL, 1),
(12, 'Organization', NULL, 1, 2, 400, NULL, 1),
(13, 'General Information', 20, 12, 3, 100, NULL, 1),
(14, 'Locations', 21, 12, 3, 200, NULL, 1),
(15, 'Structure', 22, 12, 3, 300, NULL, 1),
(16, 'Qualifications', NULL, 1, 2, 500, NULL, 1),
(17, 'Skills', 28, 16, 3, 100, NULL, 1),
(18, 'Education', 29, 16, 3, 200, NULL, 1),
(19, 'Licenses', 30, 16, 3, 300, NULL, 1),
(20, 'Languages', 31, 16, 3, 400, NULL, 1),
(21, 'Memberships', 32, 16, 3, 500, NULL, 1),
(22, 'Nationalities', 33, 1, 2, 700, NULL, 1),
(23, 'Configuration', NULL, 1, 2, 900, NULL, 1),
(24, 'Email Configuration', 34, 23, 3, 100, NULL, 1),
(25, 'Email Subscriptions', 35, 23, 3, 200, NULL, 1),
(27, 'Localization', 38, 23, 3, 300, NULL, 1),
(28, 'Modules', 39, 23, 3, 400, NULL, 1),
(30, 'PIM', 75, NULL, 1, 200, NULL, 1),
(31, 'Configuration', NULL, 30, 2, 100, NULL, 1),
(32, 'Optional Fields', 40, 31, 3, 100, NULL, 1),
(33, 'Custom Fields', 41, 31, 3, 200, NULL, 1),
(34, 'Data Import', 42, 31, 3, 300, NULL, 1),
(35, 'Reporting Methods', 43, 31, 3, 400, NULL, 1),
(36, 'Termination Reasons', 44, 31, 3, 500, NULL, 1),
(37, 'Employee List', 5, 30, 2, 200, '/reset/1', 1),
(38, 'Add Employee', 4, 30, 2, 300, NULL, 1),
(39, 'Reports', 45, 30, 2, 400, '/reportGroup/3/reportType/PIM_DEFINED', 1),
(40, 'My Info', 46, NULL, 1, 700, NULL, 1),
(41, 'Leave', 68, NULL, 1, 300, NULL, 1),
(42, 'Configure', NULL, 41, 2, 500, NULL, 0),
(43, 'Leave Period', 47, 42, 3, 100, NULL, 1),
(44, 'Leave Types', 7, 42, 3, 200, NULL, 1),
(45, 'Work Week', 14, 42, 3, 300, NULL, 1),
(46, 'Holidays', 11, 42, 3, 400, NULL, 1),
(48, 'Leave List', 16, 41, 2, 600, '/reset/1', 1),
(49, 'Assign Leave', 17, 41, 2, 700, NULL, 1),
(50, 'My Leave', 48, 41, 2, 200, '/reset/1', 1),
(51, 'Apply', 49, 41, 2, 100, NULL, 1),
(52, 'Time', 67, NULL, 1, 400, NULL, 1),
(53, 'Timesheets', NULL, 52, 2, 100, NULL, 1),
(54, 'My Timesheets', 51, 53, 3, 100, NULL, 1),
(55, 'Employee Timesheets', 52, 53, 3, 200, NULL, 1),
(56, 'Attendance', NULL, 52, 2, 200, NULL, 1),
(57, 'My Records', 53, 56, 3, 100, NULL, 1),
(58, 'Punch In/Out', 54, 56, 3, 200, NULL, 1),
(59, 'Employee Records', 55, 56, 3, 300, NULL, 1),
(60, 'Configuration', 56, 56, 3, 400, NULL, 1),
(61, 'Reports', NULL, 52, 2, 300, NULL, 1),
(62, 'Project Reports', 57, 61, 3, 100, '?reportId=1', 1),
(63, 'Employee Reports', 58, 61, 3, 200, '?reportId=2', 1),
(64, 'Attendance Summary', 59, 61, 3, 300, '?reportId=4', 1),
(65, 'Recruitment', 76, NULL, 1, 500, NULL, 1),
(66, 'Candidates', 60, 65, 2, 100, NULL, 1),
(67, 'Vacancies', 61, 65, 2, 200, NULL, 1),
(68, 'Performance', 77, NULL, 1, 600, NULL, 1),
(69, 'KPI List', 62, 68, 2, 100, NULL, 1),
(70, 'Add KPI', 63, 68, 2, 200, NULL, 1),
(71, 'Copy KPI', 64, 68, 2, 300, NULL, 1),
(72, 'Add Review', 65, 68, 2, 400, NULL, 1),
(73, 'Reviews', 66, 68, 2, 500, '/mode/new', 1),
(74, 'Entitlements', NULL, 41, 2, 300, NULL, 0),
(75, 'Add Entitlements', 72, 74, 3, 100, NULL, 1),
(76, 'My Entitlements', 70, 74, 3, 300, '/reset/1', 1),
(77, 'Employee Entitlements', 69, 74, 3, 200, '/reset/1', 1),
(78, 'Reports', NULL, 41, 2, 400, NULL, 0),
(79, 'Leave Entitlements and Usage Report', 78, 78, 3, 100, NULL, 1),
(80, 'My Leave Entitlements and Usage Report', 79, 78, 3, 200, NULL, 1),
(81, 'Users', 1, 2, 3, 100, NULL, 1);";

        /** TODO: Improve here to support upgrading installs with modified user role tables. */        
        $sql[] = "DELETE FROM ohrm_user_role_screen";
        $sql[] = "ALTER TABLE ohrm_user_role_screen AUTO_INCREMENT = 0";
        
        
        //changed by Emma
        $sql[] = "INSERT INTO `ohrm_user_role_screen` (`id`, `user_role_id`, `screen_id`, `can_read`, `can_create`, `can_update`, `can_delete`) VALUES
                (1, 1, 1, 1, 1, 1, 1),
                (2, 1, 2, 1, 1, 1, 1),
                (3, 2, 2, 0, 0, 0, 0),
                (4, 3, 2, 0, 0, 0, 0),
                (5, 1, 3, 1, 1, 1, 1),
                (6, 2, 3, 0, 0, 0, 0),
                (7, 3, 3, 0, 0, 0, 0),
                (8, 1, 4, 1, 1, 1, 1),
                (9, 1, 5, 1, 1, 1, 1),
                (10, 3, 5, 1, 0, 0, 0),
                (11, 1, 6, 1, 0, 0, 1),
                (12, 1, 7, 1, 1, 1, 1),
                (13, 1, 8, 1, 1, 1, 1),
                (14, 1, 9, 1, 1, 1, 1),
                (15, 1, 10, 1, 1, 1, 1),
                (16, 1, 11, 1, 1, 1, 1),
                (17, 1, 12, 1, 1, 1, 1),
                (18, 1, 13, 1, 1, 1, 1),
                (19, 1, 14, 1, 1, 1, 1),
                (20, 1, 16, 1, 1, 1, 0),
                (21, 3, 16, 1, 1, 1, 0),
                (22, 1, 17, 1, 1, 1, 0),
                (23, 3, 17, 1, 1, 1, 0),
                (24, 1, 18, 1, 1, 1, 0),
                (25, 2, 18, 1, 0, 0, 0),
                (26, 3, 18, 1, 0, 0, 0),
                (27, 1, 19, 1, 1, 1, 1),
                (28, 1, 20, 1, 1, 1, 1),
                (29, 1, 21, 1, 1, 1, 1),
                (30, 1, 22, 1, 1, 1, 1),
                (31, 1, 23, 1, 1, 1, 1),
                (32, 1, 24, 1, 1, 1, 1),
                (33, 1, 25, 1, 1, 1, 1),
                (34, 1, 26, 1, 1, 1, 1),
                (35, 1, 27, 1, 1, 1, 1),
                (36, 1, 28, 1, 1, 1, 1),
                (37, 1, 29, 1, 1, 1, 1),
                (38, 1, 30, 1, 1, 1, 1),
                (39, 1, 31, 1, 1, 1, 1),
                (40, 1, 32, 1, 1, 1, 1),
                (41, 1, 33, 1, 1, 1, 1),
                (42, 1, 34, 1, 1, 1, 1),
                (43, 1, 35, 1, 1, 1, 1),
                (44, 1, 36, 1, 1, 1, 1),
                (45, 1, 37, 1, 1, 1, 1),
                (46, 4, 37, 1, 0, 0, 0),
                (47, 1, 38, 1, 1, 1, 1),
                (48, 1, 39, 1, 1, 1, 1),
                (49, 1, 40, 1, 1, 1, 1),
                (50, 1, 41, 1, 1, 1, 1),
                (51, 1, 42, 1, 1, 1, 1),
                (52, 1, 43, 1, 1, 1, 1),
                (53, 1, 44, 1, 1, 1, 1),
                (54, 1, 45, 1, 1, 1, 1),
                (55, 2, 46, 1, 1, 1, 1),
                (56, 1, 47, 1, 1, 1, 1),
                (57, 2, 48, 1, 1, 1, 0),
                (58, 2, 49, 1, 1, 1, 1),
                (59, 1, 50, 1, 1, 1, 1),
                (60, 2, 50, 1, 0, 0, 0),
                (61, 2, 51, 1, 1, 1, 1),
                (62, 1, 52, 1, 1, 1, 1),
                (63, 3, 52, 1, 1, 1, 1),
                (64, 2, 53, 1, 1, 0, 0),
                (65, 2, 54, 1, 1, 1, 1),
                (66, 1, 55, 1, 1, 0, 1),
                (67, 3, 55, 1, 1, 0, 0),
                (68, 1, 56, 1, 1, 1, 1),
                (69, 1, 57, 1, 1, 1, 1),
                (70, 4, 57, 1, 1, 1, 1),
                (71, 1, 58, 1, 1, 1, 1),
                (72, 3, 58, 1, 1, 1, 1),
                (73, 1, 59, 1, 1, 1, 1),
                (74, 3, 59, 1, 1, 1, 1),
                (75, 1, 60, 1, 1, 1, 1),
                (76, 6, 60, 1, 1, 1, 1),
                (77, 5, 60, 1, 0, 1, 0),
                (78, 1, 61, 1, 1, 1, 1),
                (79, 1, 62, 1, 1, 1, 1),
                (80, 1, 63, 1, 1, 1, 1),
                (81, 1, 64, 1, 1, 1, 1),
                (82, 1, 65, 1, 1, 1, 1),
                (83, 1, 66, 1, 1, 1, 1),
                (84, 2, 66, 1, 0, 1, 0),
                (85, 7, 66, 1, 0, 1, 0),
                (86, 1, 67, 1, 1, 1, 1),
                (87, 2, 67, 1, 0, 1, 0),
                (88, 3, 67, 1, 0, 1, 0),
                (89, 1, 68, 1, 1, 1, 1),
                (90, 2, 68, 1, 0, 1, 0),
                (91, 3, 68, 1, 0, 1, 0),
                (92, 1, 69, 1, 1, 1, 1),
                (93, 3, 69, 1, 0, 0, 0),
                (94, 2, 70, 1, 0, 0, 0),
                (95, 1, 71, 1, 0, 0, 1),
                (96, 1, 72, 1, 1, 1, 0),
                (97, 1, 73, 1, 0, 1, 0),
                (98, 1, 74, 1, 1, 1, 1),
                (99, 4, 74, 1, 1, 1, 1),
                (100, 1, 75, 1, 1, 1, 1),
                (101, 3, 75, 1, 1, 1, 1),
                (102, 1, 76, 1, 1, 1, 1),
                (103, 5, 76, 1, 1, 1, 1),
                (104, 6, 76, 1, 1, 1, 1),
                (105, 1, 77, 1, 1, 1, 1),
                (106, 2, 77, 1, 1, 1, 1),
                (107, 7, 77, 1, 1, 1, 1),
                (108, 1, 78, 1, 0, 0, 0),
                (109, 3, 78, 1, 0, 0, 0),
                (110, 2, 79, 1, 0, 0, 0);";
                               
        /* Importing leave type and entitlement data */
        $sql[] = "alter table `hs_hr_leavetype` add column int_id int not null auto_increment unique key;";

        $sql[] = "INSERT INTO `ohrm_leave_type` (`id`, `name`, `deleted`, `operational_country_id`)
                            SELECT old_lt.`int_id`, old_lt.`leave_type_name`, 
                            IF(old_lt.`available_flag` = 1, 0, 1) , old_lt.`operational_country_id`
                            FROM `hs_hr_leavetype` old_lt;";


        //commented by emma
//        $sql[] = "INSERT INTO `ohrm_leave_entitlement`(emp_number, no_of_days, leave_type_id, from_date, to_date, 
//                                        credited_date, note, entitlement_type, `deleted`)
//                    SELECT q.employee_id, q.no_of_days_allotted, lt.int_id, p.leave_period_start_date, p.leave_period_end_date, 
//                    p.leave_period_start_date, 'record created by upgrade', 1, 0
//                    FROM `hs_hr_employee_leave_quota` q LEFT JOIN `hs_hr_leavetype` lt ON lt.leave_type_id = q.leave_type_id
//                    LEFT JOIN hs_hr_leave_period p ON p.leave_period_id = q.leave_period_id;";

                $sql[] = "INSERT INTO `ohrm_leave_entitlement`(emp_number, no_of_days, leave_type_id, from_date, to_date, 
                                        credited_date, note, entitlement_type, `deleted`)
                    SELECT q.employee_id, q.no_of_days_allotted, lt.int_id, p.leave_period_start_date, p.leave_period_end_date, 
                    p.leave_period_start_date, 'record created by upgrade', 1, 0
                    FROM `hs_hr_employee_leave_quota` q, `hs_hr_leavetype` lt, hs_hr_leave_period p WHERE lt.leave_type_id = q.leave_type_id AND p.leave_period_id = q.leave_period_id;"; 
                     

        //commented by emma, NOTE: does this when leave related changes are completed
        //$sql[] = "alter table `hs_hr_leavetype` drop column int_id;";

        $sql[] = "INSERT INTO `ohrm_leave_period`(leave_period_id, leave_period_start_date, leave_period_end_date) 
                    SELECT leave_period_id, leave_period_start_date, leave_period_end_date FROM hs_hr_leave_period";
        
        /* TODO: Import rest of leave data - leave requests etc. */
        /* ruchira part - ends */
        
        
        
        
        /* straight forward new table creation & data insertion - by emma */
        
        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_advanced_report` (
                    `id` int(10) NOT NULL,
                    `name` varchar(100) NOT NULL,
                    `definition` longtext NOT NULL,
                    PRIMARY KEY (`id`)
                  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;";
        
        $sql[] = "INSERT INTO `ohrm_advanced_report` (`id`, `name`, `definition`) VALUES
            (1, 'Leave Entitlements and Usage Report', '\n<report>\n    <settings>\n        <csv>\n            <include_group_header>1</include_group_header>\n            <include_header>1</include_header>\n        </csv>\n    </settings>\n<filter_fields>\n	<input_field type=''text'' name=''empNumber'' label=''Employee Number''></input_field>\n	<input_field type=''text'' name=''fromDate'' label=''From''></input_field>\n        <input_field type=''text'' name=''toDate'' label=''To''></input_field>\n        <input_field type=''text'' name=''asOfDate'' label=''AsOf''></input_field>\n</filter_fields> \n\n<sub_report type=''sql'' name=''mainTable''>       \n    <query>FROM ohrm_leave_type WHERE (deleted = 0) OR (SELECT count(l.id) FROM ohrm_leave l WHERE l.status = 3 AND l.leave_type_id = ohrm_leave_type.id) > 0 ORDER BY ohrm_leave_type.id</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n        <display_group name=''leavetype'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>ohrm_leave_type.id</field_name>\n                    <field_alias>leaveTypeId</field_alias>\n                    <display_name>Leave Type ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''false''>\n                    <field_name>ohrm_leave_type.exclude_in_reports_if_no_entitlement</field_name>\n                    <field_alias>exclude_if_no_entitlement</field_alias>\n                    <display_name>Exclude</display_name>\n                    <width>1</width>	\n                </field>  \n                <field display=''false''>\n                    <field_name>ohrm_leave_type.deleted</field_name>\n                    <field_alias>leave_type_deleted</field_alias>\n                    <display_name>Leave Type Deleted</display_name>\n                    <width>1</width>	\n                </field>  \n                <field display=''true''>\n                    <field_name>ohrm_leave_type.name</field_name>\n                    <field_alias>leaveType</field_alias>\n                    <display_name>Leave Type</display_name>\n                    <width>160</width>	\n                </field>s                                                                                                     \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n<sub_report type=''sql'' name=''entitlementsTotal''>\n                    <query>\n\nFROM (\nSELECT ohrm_leave_entitlement.id as id, \n       ohrm_leave_entitlement.leave_type_id as leave_type_id,\n       ohrm_leave_entitlement.no_of_days as no_of_days,\n       sum(IF(ohrm_leave.status = 2, ohrm_leave_leave_entitlement.length_days, 0)) AS scheduled,\n       sum(IF(ohrm_leave.status = 3, ohrm_leave_leave_entitlement.length_days, 0)) AS taken\n       \nFROM ohrm_leave_entitlement LEFT JOIN ohrm_leave_leave_entitlement ON\n    ohrm_leave_entitlement.id = ohrm_leave_leave_entitlement.entitlement_id\n    LEFT JOIN ohrm_leave ON ohrm_leave.id = ohrm_leave_leave_entitlement.leave_id AND \n    ( \$X{&gt;,ohrm_leave.date,toDate} OR \$X{&lt;,ohrm_leave.date,fromDate} )\n\nWHERE ohrm_leave_entitlement.deleted=0 AND \$X{=,ohrm_leave_entitlement.emp_number,empNumber} AND \n    \$X{IN,ohrm_leave_entitlement.leave_type_id,leaveTypeId} AND\n    (\n      ( \$X{&lt;=,ohrm_leave_entitlement.from_date,fromDate} AND \$X{&gt;=,ohrm_leave_entitlement.to_date,fromDate} ) OR\n      ( \$X{&lt;=,ohrm_leave_entitlement.from_date,toDate} AND \$X{&gt;=,ohrm_leave_entitlement.to_date,toDate} ) OR \n      ( \$X{&gt;=,ohrm_leave_entitlement.from_date,fromDate} AND \$X{&lt;=,ohrm_leave_entitlement.to_date,toDate} ) \n    )\n    \nGROUP BY ohrm_leave_entitlement.id\n) AS A\n\nGROUP BY A.leave_type_id\nORDER BY A.leave_type_id\n\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g2'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>A.leave_type_id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(A.no_of_days) - sum(A.scheduled) - sum(A.taken)</field_name>\n                        <field_alias>entitlement_total</field_alias>\n                        <display_name>Leave Entitlements (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''pendingQuery''>\n<query>\nFROM ohrm_leave_type LEFT JOIN \nohrm_leave ON ohrm_leave_type.id = ohrm_leave.leave_type_id AND\n\$X{=,ohrm_leave.emp_number,empNumber} AND\nohrm_leave.status = 1 AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nWHERE\nohrm_leave_type.deleted = 0 AND\n\$X{IN,ohrm_leave_type.id,leaveTypeId}\n\nGROUP BY ohrm_leave_type.id\nORDER BY ohrm_leave_type.id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g6'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave_type.id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>pending</field_alias>\n                        <display_name>Leave Pending Approval (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=1&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''scheduledQuery''>\n<query>\nFROM ohrm_leave_type LEFT JOIN \nohrm_leave ON ohrm_leave_type.id = ohrm_leave.leave_type_id AND\n\$X{=,ohrm_leave.emp_number,empNumber} AND\nohrm_leave.status = 2 AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nWHERE\nohrm_leave_type.deleted = 0 AND\n\$X{IN,ohrm_leave_type.id,leaveTypeId}\n\nGROUP BY ohrm_leave_type.id\nORDER BY ohrm_leave_type.id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g5'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave_type.id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>scheduled</field_alias>\n                        <display_name>Leave Scheduled (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=2&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''takenQuery''>\n<query>\nFROM ohrm_leave WHERE \$X{=,emp_number,empNumber} AND\nstatus = 3 AND\n\$X{IN,ohrm_leave.leave_type_id,leaveTypeId} AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY leave_type_id\nORDER BY ohrm_leave.leave_type_id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g4'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.leave_type_id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>taken</field_alias>\n                        <display_name>Leave Taken (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=3&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''unused''>       \n    <query>FROM ohrm_leave_type WHERE deleted = 0 AND \$X{IN,ohrm_leave_type.id,leaveTypeId} ORDER BY ohrm_leave_type.id</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n        <display_group name=''unused'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>ohrm_leave_type.id</field_name>\n                    <field_alias>leaveTypeId</field_alias>\n                    <display_name>Leave Type ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''true''>\n                    <field_name>ohrm_leave_type.name</field_name>\n                    <field_alias>unused</field_alias>\n                    <display_name>Leave Balance (Days)</display_name>\n                    <width>160</width>	\n                    <align>right</align>\n                </field>                                                                                                     \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n\n    <join>             \n        <join_by sub_report=''mainTable'' id=''leaveTypeId''></join_by>              \n        <join_by sub_report=''entitlementsTotal'' id=''leaveTypeId''></join_by> \n        <join_by sub_report=''pendingQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''scheduledQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''takenQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''unused'' id=''leaveTypeId''></join_by>  \n\n    </join>\n    <page_limit>100</page_limit>        \n</report>'),
            (2, 'Leave Entitlements and Usage Report', '\n<report>\n    <settings>\n        <csv>\n            <include_group_header>1</include_group_header>\n            <include_header>1</include_header>\n        </csv>\n    </settings>\n<filter_fields>\n	<input_field type=''text'' name=''leaveType'' label=''Leave Type''></input_field>\n	<input_field type=''text'' name=''fromDate'' label=''From''></input_field>\n        <input_field type=''text'' name=''toDate'' label=''To''></input_field>\n        <input_field type=''text'' name=''asOfDate'' label=''AsOf''></input_field>\n        <input_field type=''text'' name=''emp_numbers'' label=''employees''></input_field>\n        <input_field type=''text'' name=''job_title'' label=''Job Title''></input_field>\n        <input_field type=''text'' name=''location'' label=''Location''></input_field>\n        <input_field type=''text'' name=''sub_unit'' label=''Sub Unit''></input_field>\n        <input_field type=''text'' name=''terminated'' label=''Terminated''></input_field>\n</filter_fields> \n\n<sub_report type=''sql'' name=''mainTable''>       \n    <query>FROM hs_hr_employee \n    LEFT JOIN hs_hr_emp_locations ON hs_hr_employee.emp_number = hs_hr_emp_locations.emp_number\n    WHERE \$X{IN,hs_hr_employee.emp_number,emp_numbers} \n    AND \$X{=,hs_hr_employee.job_title_code,job_title}\n    AND \$X{IN,hs_hr_employee.work_station,sub_unit}\n    AND \$X{IN,hs_hr_emp_locations.location_id,location}\n    AND \$X{IS NULL,hs_hr_employee.termination_id,terminated}\n    ORDER BY hs_hr_employee.emp_lastname</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n        <display_group name=''personalDetails'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>hs_hr_employee.emp_number</field_name>\n                    <field_alias>empNumber</field_alias>\n                    <display_name>Employee Number</display_name>\n                    <width>1</width>	\n                </field>                \n                <field display=''false''>\n                    <field_name>hs_hr_employee.termination_id</field_name>\n                    <field_alias>termination_id</field_alias>\n                    <display_name>Termination ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''true''>\n                    <field_name>CONCAT(hs_hr_employee.emp_firstname, '' '', hs_hr_employee.emp_lastname)</field_name>\n                    <field_alias>employeeName</field_alias>\n                    <display_name>Employee</display_name>\n                    <width>150</width>\n                </field>                                                                                               \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n<sub_report type=''sql'' name=''entitlementsTotal''>\n                    <query>\n\nFROM (\nSELECT ohrm_leave_entitlement.id as id, \n       ohrm_leave_entitlement.emp_number as emp_number,\n       ohrm_leave_entitlement.no_of_days as no_of_days,\n       sum(IF(ohrm_leave.status = 2, ohrm_leave_leave_entitlement.length_days, 0)) AS scheduled,\n       sum(IF(ohrm_leave.status = 3, ohrm_leave_leave_entitlement.length_days, 0)) AS taken\n       \nFROM ohrm_leave_entitlement LEFT JOIN ohrm_leave_leave_entitlement ON\n    ohrm_leave_entitlement.id = ohrm_leave_leave_entitlement.entitlement_id\n    LEFT JOIN ohrm_leave ON ohrm_leave.id = ohrm_leave_leave_entitlement.leave_id AND \n    ( \$X{&gt;,ohrm_leave.date,toDate} OR \$X{&lt;,ohrm_leave.date,fromDate} )\n\nWHERE ohrm_leave_entitlement.deleted=0 AND \$X{=,ohrm_leave_entitlement.leave_type_id,leaveType}\n    AND \$X{IN,ohrm_leave_entitlement.emp_number,empNumber} AND\n    (\n      ( \$X{&lt;=,ohrm_leave_entitlement.from_date,fromDate} AND \$X{&gt;=,ohrm_leave_entitlement.to_date,fromDate} ) OR\n      ( \$X{&lt;=,ohrm_leave_entitlement.from_date,toDate} AND \$X{&gt;=,ohrm_leave_entitlement.to_date,toDate} ) OR \n      ( \$X{&gt;=,ohrm_leave_entitlement.from_date,fromDate} AND \$X{&lt;=,ohrm_leave_entitlement.to_date,toDate} ) \n    )\n    \nGROUP BY ohrm_leave_entitlement.id\n) AS A\n\nGROUP BY A.emp_number\nORDER BY A.emp_number\n\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g2'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>A.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(A.no_of_days) - sum(A.scheduled) - sum(A.taken)</field_name>\n                        <field_alias>entitlement_total</field_alias>\n                        <display_name>Leave Entitlements (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''pendingQuery''>\n<query>\nFROM ohrm_leave WHERE \$X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 1 AND\n\$X{IN,ohrm_leave.emp_number,empNumber} AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g6'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>pending</field_alias>\n                        <display_name>Leave Pending Approval (Days)</display_name>\n                        <width>121</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=1&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n\n<sub_report type=''sql'' name=''scheduledQuery''>\n<query>\nFROM ohrm_leave WHERE \$X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 2 AND\n\$X{IN,ohrm_leave.emp_number,empNumber} AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g5'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>scheduled</field_alias>\n                        <display_name>Leave Scheduled (Days)</display_name>\n                        <width>121</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=2&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''takenQuery''>\n<query>\nFROM ohrm_leave WHERE \$X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 3 AND\n\$X{IN,ohrm_leave.emp_number,empNumber} AND\n\$X{&gt;=,ohrm_leave.date,fromDate} AND \$X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g4'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>taken</field_alias>\n                        <display_name>Leave Taken (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=3&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n<sub_report type=''sql'' name=''unused''>       \n    <query>FROM hs_hr_employee WHERE \$X{IN,hs_hr_employee.emp_number,empNumber} ORDER BY hs_hr_employee.emp_number</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n        <display_group name=''unused'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>    \n                <field display=''false''>\n                    <field_name>hs_hr_employee.emp_number</field_name>\n                    <field_alias>empNumber</field_alias>\n                    <display_name>Employee Number</display_name>\n                    <width>1</width>	\n                </field>                \n                <field display=''true''>\n                    <field_name>hs_hr_employee.emp_firstname</field_name>\n                    <field_alias>unused</field_alias>\n                    <display_name>Leave Balance (Days)</display_name>\n                    <width>150</width>\n                    <align>right</align>\n                </field> \n                                                                                               \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n    <join>             \n        <join_by sub_report=''mainTable'' id=''empNumber''></join_by>            \n        <join_by sub_report=''entitlementsTotal'' id=''empNumber''></join_by> \n        <join_by sub_report=''pendingQuery'' id=''empNumber''></join_by>\n        <join_by sub_report=''scheduledQuery'' id=''empNumber''></join_by>\n        <join_by sub_report=''takenQuery'' id=''empNumber''></join_by> \n        <join_by sub_report=''unused'' id=''empNumber''></join_by>  \n    </join>\n    <page_limit>20</page_limit>       \n</report>');";

//        $sql[] = "INSERT INTO `ohrm_advanced_report` (`id`, `name`, `definition`) VALUES
//            (1, 'Leave Entitlements and Usage Report', '\n<report>\n    <settings>\n        <csv>\n            <include_group_header>1</include_group_header>\n            <include_header>1</include_header>\n        </csv>\n    </settings>\n<filter_fields>\n	<input_field type=''text'' name=''empNumber'' label=''Employee Number''></input_field>\n	<input_field type=''text'' name=''fromDate'' label=''From''></input_field>\n        <input_field type=''text'' name=''toDate'' label=''To''></input_field>\n        <input_field type=''text'' name=''asOfDate'' label=''AsOf''></input_field>\n</filter_fields> \n\n<sub_report type=''sql'' name=''mainTable''>       \n    <query>FROM ohrm_leave_type WHERE (deleted = 0) OR (SELECT count(l.id) FROM ohrm_leave l WHERE l.status = 3 AND l.leave_type_id = ohrm_leave_type.id) > 0 ORDER BY ohrm_leave_type.id</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n        <display_group name=''leavetype'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>ohrm_leave_type.id</field_name>\n                    <field_alias>leaveTypeId</field_alias>\n                    <display_name>Leave Type ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''false''>\n                    <field_name>ohrm_leave_type.exclude_in_reports_if_no_entitlement</field_name>\n                    <field_alias>exclude_if_no_entitlement</field_alias>\n                    <display_name>Exclude</display_name>\n                    <width>1</width>	\n                </field>  \n                <field display=''false''>\n                    <field_name>ohrm_leave_type.deleted</field_name>\n                    <field_alias>leave_type_deleted</field_alias>\n                    <display_name>Leave Type Deleted</display_name>\n                    <width>1</width>	\n                </field>  \n                <field display=''true''>\n                    <field_name>ohrm_leave_type.name</field_name>\n                    <field_alias>leaveType</field_alias>\n                    <display_name>Leave Type</display_name>\n                    <width>160</width>	\n                </field>s                                                                                                     \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n<sub_report type=''sql'' name=''entitlementsTotal''>\n                    <query>\n\nFROM (\nSELECT ohrm_leave_entitlement.id as id, \n       ohrm_leave_entitlement.leave_type_id as leave_type_id,\n       ohrm_leave_entitlement.no_of_days as no_of_days,\n       sum(IF(ohrm_leave.status = 2, ohrm_leave_leave_entitlement.length_days, 0)) AS scheduled,\n       sum(IF(ohrm_leave.status = 3, ohrm_leave_leave_entitlement.length_days, 0)) AS taken\n       \nFROM ohrm_leave_entitlement LEFT JOIN ohrm_leave_leave_entitlement ON\n    ohrm_leave_entitlement.id = ohrm_leave_leave_entitlement.entitlement_id\n    LEFT JOIN ohrm_leave ON ohrm_leave.id = ohrm_leave_leave_entitlement.leave_id AND \n    ( $X{&gt;,ohrm_leave.date,toDate} OR $X{&lt;,ohrm_leave.date,fromDate} )\n\nWHERE ohrm_leave_entitlement.deleted=0 AND $X{=,ohrm_leave_entitlement.emp_number,empNumber} AND \n    $X{IN,ohrm_leave_entitlement.leave_type_id,leaveTypeId} AND\n    (\n      ( $X{&lt;=,ohrm_leave_entitlement.from_date,fromDate} AND $X{&gt;=,ohrm_leave_entitlement.to_date,fromDate} ) OR\n      ( $X{&lt;=,ohrm_leave_entitlement.from_date,toDate} AND $X{&gt;=,ohrm_leave_entitlement.to_date,toDate} ) OR \n      ( $X{&gt;=,ohrm_leave_entitlement.from_date,fromDate} AND $X{&lt;=,ohrm_leave_entitlement.to_date,toDate} ) \n    )\n    \nGROUP BY ohrm_leave_entitlement.id\n) AS A\n\nGROUP BY A.leave_type_id\nORDER BY A.leave_type_id\n\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g2'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>A.leave_type_id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(A.no_of_days) - sum(A.scheduled) - sum(A.taken)</field_name>\n                        <field_alias>entitlement_total</field_alias>\n                        <display_name>Leave Entitlements (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''pendingQuery''>\n<query>\nFROM ohrm_leave_type LEFT JOIN \nohrm_leave ON ohrm_leave_type.id = ohrm_leave.leave_type_id AND\n$X{=,ohrm_leave.emp_number,empNumber} AND\nohrm_leave.status = 1 AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nWHERE\nohrm_leave_type.deleted = 0 AND\n$X{IN,ohrm_leave_type.id,leaveTypeId}\n\nGROUP BY ohrm_leave_type.id\nORDER BY ohrm_leave_type.id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g6'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave_type.id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>pending</field_alias>\n                        <display_name>Leave Pending Approval (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=1&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''scheduledQuery''>\n<query>\nFROM ohrm_leave_type LEFT JOIN \nohrm_leave ON ohrm_leave_type.id = ohrm_leave.leave_type_id AND\n$X{=,ohrm_leave.emp_number,empNumber} AND\nohrm_leave.status = 2 AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nWHERE\nohrm_leave_type.deleted = 0 AND\n$X{IN,ohrm_leave_type.id,leaveTypeId}\n\nGROUP BY ohrm_leave_type.id\nORDER BY ohrm_leave_type.id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g5'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave_type.id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>scheduled</field_alias>\n                        <display_name>Leave Scheduled (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=2&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''takenQuery''>\n<query>\nFROM ohrm_leave WHERE $X{=,emp_number,empNumber} AND\nstatus = 3 AND\n$X{IN,ohrm_leave.leave_type_id,leaveTypeId} AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY leave_type_id\nORDER BY ohrm_leave.leave_type_id\n</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n            <display_group name=''g4'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.leave_type_id</field_name>\n                        <field_alias>leaveTypeId</field_alias>\n                        <display_name>Leave Type ID</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>taken</field_alias>\n                        <display_name>Leave Taken (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=3&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n    </sub_report>\n\n<sub_report type=''sql'' name=''unused''>       \n    <query>FROM ohrm_leave_type WHERE deleted = 0 AND $X{IN,ohrm_leave_type.id,leaveTypeId} ORDER BY ohrm_leave_type.id</query>\n    <id_field>leaveTypeId</id_field>\n    <display_groups>\n        <display_group name=''unused'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>ohrm_leave_type.id</field_name>\n                    <field_alias>leaveTypeId</field_alias>\n                    <display_name>Leave Type ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''true''>\n                    <field_name>ohrm_leave_type.name</field_name>\n                    <field_alias>unused</field_alias>\n                    <display_name>Leave Balance (Days)</display_name>\n                    <width>160</width>	\n                    <align>right</align>\n                </field>                                                                                                     \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n\n    <join>             \n        <join_by sub_report=''mainTable'' id=''leaveTypeId''></join_by>              \n        <join_by sub_report=''entitlementsTotal'' id=''leaveTypeId''></join_by> \n        <join_by sub_report=''pendingQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''scheduledQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''takenQuery'' id=''leaveTypeId''></join_by>  \n        <join_by sub_report=''unused'' id=''leaveTypeId''></join_by>  \n\n    </join>\n    <page_limit>100</page_limit>        \n</report>'),
//            (2, 'Leave Entitlements and Usage Report', '\n<report>\n    <settings>\n        <csv>\n            <include_group_header>1</include_group_header>\n            <include_header>1</include_header>\n        </csv>\n    </settings>\n<filter_fields>\n	<input_field type=''text'' name=''leaveType'' label=''Leave Type''></input_field>\n	<input_field type=''text'' name=''fromDate'' label=''From''></input_field>\n        <input_field type=''text'' name=''toDate'' label=''To''></input_field>\n        <input_field type=''text'' name=''asOfDate'' label=''AsOf''></input_field>\n        <input_field type=''text'' name=''emp_numbers'' label=''employees''></input_field>\n        <input_field type=''text'' name=''job_title'' label=''Job Title''></input_field>\n        <input_field type=''text'' name=''location'' label=''Location''></input_field>\n        <input_field type=''text'' name=''sub_unit'' label=''Sub Unit''></input_field>\n        <input_field type=''text'' name=''terminated'' label=''Terminated''></input_field>\n</filter_fields> \n\n<sub_report type=''sql'' name=''mainTable''>       \n    <query>FROM hs_hr_employee \n    LEFT JOIN hs_hr_emp_locations ON hs_hr_employee.emp_number = hs_hr_emp_locations.emp_number\n    WHERE $X{IN,hs_hr_employee.emp_number,emp_numbers} \n    AND $X{=,hs_hr_employee.job_title_code,job_title}\n    AND $X{IN,hs_hr_employee.work_station,sub_unit}\n    AND $X{IN,hs_hr_emp_locations.location_id,location}\n    AND $X{IS NULL,hs_hr_employee.termination_id,terminated}\n    ORDER BY hs_hr_employee.emp_lastname</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n        <display_group name=''personalDetails'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>\n                <field display=''false''>\n                    <field_name>hs_hr_employee.emp_number</field_name>\n                    <field_alias>empNumber</field_alias>\n                    <display_name>Employee Number</display_name>\n                    <width>1</width>	\n                </field>                \n                <field display=''false''>\n                    <field_name>hs_hr_employee.termination_id</field_name>\n                    <field_alias>termination_id</field_alias>\n                    <display_name>Termination ID</display_name>\n                    <width>1</width>	\n                </field>   \n                <field display=''true''>\n                    <field_name>CONCAT(hs_hr_employee.emp_firstname, '' '', hs_hr_employee.emp_lastname)</field_name>\n                    <field_alias>employeeName</field_alias>\n                    <display_name>Employee</display_name>\n                    <width>150</width>\n                </field>                                                                                               \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n\n<sub_report type=''sql'' name=''entitlementsTotal''>\n                    <query>\n\nFROM (\nSELECT ohrm_leave_entitlement.id as id, \n       ohrm_leave_entitlement.emp_number as emp_number,\n       ohrm_leave_entitlement.no_of_days as no_of_days,\n       sum(IF(ohrm_leave.status = 2, ohrm_leave_leave_entitlement.length_days, 0)) AS scheduled,\n       sum(IF(ohrm_leave.status = 3, ohrm_leave_leave_entitlement.length_days, 0)) AS taken\n       \nFROM ohrm_leave_entitlement LEFT JOIN ohrm_leave_leave_entitlement ON\n    ohrm_leave_entitlement.id = ohrm_leave_leave_entitlement.entitlement_id\n    LEFT JOIN ohrm_leave ON ohrm_leave.id = ohrm_leave_leave_entitlement.leave_id AND \n    ( $X{&gt;,ohrm_leave.date,toDate} OR $X{&lt;,ohrm_leave.date,fromDate} )\n\nWHERE ohrm_leave_entitlement.deleted=0 AND $X{=,ohrm_leave_entitlement.leave_type_id,leaveType}\n    AND $X{IN,ohrm_leave_entitlement.emp_number,empNumber} AND\n    (\n      ( $X{&lt;=,ohrm_leave_entitlement.from_date,fromDate} AND $X{&gt;=,ohrm_leave_entitlement.to_date,fromDate} ) OR\n      ( $X{&lt;=,ohrm_leave_entitlement.from_date,toDate} AND $X{&gt;=,ohrm_leave_entitlement.to_date,toDate} ) OR \n      ( $X{&gt;=,ohrm_leave_entitlement.from_date,fromDate} AND $X{&lt;=,ohrm_leave_entitlement.to_date,toDate} ) \n    )\n    \nGROUP BY ohrm_leave_entitlement.id\n) AS A\n\nGROUP BY A.emp_number\nORDER BY A.emp_number\n\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g2'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>A.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(A.no_of_days) - sum(A.scheduled) - sum(A.taken)</field_name>\n                        <field_alias>entitlement_total</field_alias>\n                        <display_name>Leave Entitlements (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''pendingQuery''>\n<query>\nFROM ohrm_leave WHERE $X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 1 AND\n$X{IN,ohrm_leave.emp_number,empNumber} AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g6'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>pending</field_alias>\n                        <display_name>Leave Pending Approval (Days)</display_name>\n                        <width>121</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=1&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n\n<sub_report type=''sql'' name=''scheduledQuery''>\n<query>\nFROM ohrm_leave WHERE $X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 2 AND\n$X{IN,ohrm_leave.emp_number,empNumber} AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g5'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>scheduled</field_alias>\n                        <display_name>Leave Scheduled (Days)</display_name>\n                        <width>121</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=2&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n\n<sub_report type=''sql'' name=''takenQuery''>\n<query>\nFROM ohrm_leave WHERE $X{=,ohrm_leave.leave_type_id,leaveType} AND\nstatus = 3 AND\n$X{IN,ohrm_leave.emp_number,empNumber} AND\n$X{&gt;=,ohrm_leave.date,fromDate} AND $X{&lt;=,ohrm_leave.date,toDate}\nGROUP BY emp_number\nORDER BY ohrm_leave.emp_number\n</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n            <display_group name=''g4'' type=''one'' display=''true''>\n                <group_header></group_header>\n                <fields>\n                    <field display=''false''>\n                        <field_name>ohrm_leave.emp_number</field_name>\n                        <field_alias>empNumber</field_alias>\n                        <display_name>Emp Number</display_name>\n                        <width>1</width>\n                    </field>                                \n                    <field display=''true''>\n                        <field_name>sum(length_days)</field_name>\n                        <field_alias>taken</field_alias>\n                        <display_name>Leave Taken (Days)</display_name>\n                        <width>120</width>\n                        <align>right</align>\n                        <link>leave/viewLeaveList?empNumber=$P{empNumber}&amp;fromDate=$P{fromDate}&amp;toDate=$P{toDate}&amp;leaveTypeId=$P{leaveType}&amp;status=3&amp;stddate=1</link>\n                    </field>                                \n                </fields>\n            </display_group>\n    </display_groups>\n</sub_report>\n<sub_report type=''sql'' name=''unused''>       \n    <query>FROM hs_hr_employee WHERE $X{IN,hs_hr_employee.emp_number,empNumber} ORDER BY hs_hr_employee.emp_number</query>\n    <id_field>empNumber</id_field>\n    <display_groups>\n        <display_group name=''unused'' type=''one'' display=''true''>\n            <group_header></group_header>\n            <fields>    \n                <field display=''false''>\n                    <field_name>hs_hr_employee.emp_number</field_name>\n                    <field_alias>empNumber</field_alias>\n                    <display_name>Employee Number</display_name>\n                    <width>1</width>	\n                </field>                \n                <field display=''true''>\n                    <field_name>hs_hr_employee.emp_firstname</field_name>\n                    <field_alias>unused</field_alias>\n                    <display_name>Leave Balance (Days)</display_name>\n                    <width>150</width>\n                    <align>right</align>\n                </field> \n                                                                                               \n            </fields>\n        </display_group>\n    </display_groups> \n</sub_report>\n    <join>             \n        <join_by sub_report=''mainTable'' id=''empNumber''></join_by>            \n        <join_by sub_report=''entitlementsTotal'' id=''empNumber''></join_by> \n        <join_by sub_report=''pendingQuery'' id=''empNumber''></join_by>\n        <join_by sub_report=''scheduledQuery'' id=''empNumber''></join_by>\n        <join_by sub_report=''takenQuery'' id=''empNumber''></join_by> \n        <join_by sub_report=''unused'' id=''empNumber''></join_by>  \n    </join>\n    <page_limit>20</page_limit>       \n</report>');";

        
        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_email` (
                    `id` int(6) NOT NULL AUTO_INCREMENT,
                    `name` varchar(100) NOT NULL,
                    PRIMARY KEY (`id`),
                    UNIQUE KEY `name` (`name`),
                    UNIQUE KEY `ohrm_email_name` (`name`)
                  ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=7 ;";


        $sql[] = "INSERT INTO `ohrm_email` (`id`, `name`) VALUES
            (1, 'leave.apply'),
            (3, 'leave.approve'),
            (2, 'leave.assign'),
            (4, 'leave.cancel'),
            (6, 'leave.change'),
            (5, 'leave.reject');";

        
        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_email_processor` (
            `id` int(6) NOT NULL AUTO_INCREMENT,
            `email_id` int(6) NOT NULL,
            `class_name` varchar(100) DEFAULT NULL,
            PRIMARY KEY (`id`),
            KEY `email_id` (`email_id`)
          ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=7 ;";


        $sql[] = "INSERT INTO `ohrm_email_processor` (`id`, `email_id`, `class_name`) VALUES
            (1, 1, 'LeaveEmailProcessor'),
            (2, 2, 'LeaveEmailProcessor'),
            (3, 3, 'LeaveEmailProcessor'),
            (4, 4, 'LeaveEmailProcessor'),
            (5, 5, 'LeaveEmailProcessor'),
            (6, 6, 'LeaveChangeMailProcessor');";

        $sql[] = "ALTER TABLE `ohrm_email_processor`
          ADD CONSTRAINT `ohrm_email_processor_ibfk_1` FOREIGN KEY (`email_id`) REFERENCES `ohrm_email` (`id`) ON DELETE CASCADE;";

        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_email_template` (
                    `id` int(6) NOT NULL AUTO_INCREMENT,
                    `email_id` int(6) NOT NULL,
                    `locale` varchar(20) DEFAULT NULL,
                    `performer_role` varchar(50) DEFAULT NULL,
                    `recipient_role` varchar(50) DEFAULT NULL,
                    `subject` varchar(255) DEFAULT NULL,
                    `body` text,
                    PRIMARY KEY (`id`),
                    KEY `email_id` (`email_id`)
                  ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=16 ;";


        $sql[] = "INSERT INTO `ohrm_email_template` (`id`, `email_id`, `locale`, `performer_role`, `recipient_role`, `subject`, `body`) VALUES
        (1, 1, 'en_US', NULL, 'supervisor', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/apply/leaveApplicationSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/apply/leaveApplicationBody.txt'),
        (2, 1, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/apply/leaveApplicationSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/apply/leaveApplicationSubscriberBody.txt'),
        (3, 3, 'en_US', NULL, 'ess', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/approve/leaveApprovalSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/approve/leaveApprovalBody.txt'),
        (4, 3, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/approve/leaveApprovalSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/approve/leaveApprovalSubscriberBody.txt'),
        (5, 2, 'en_US', NULL, 'ess', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentBody.txt'),
        (6, 2, 'en_US', NULL, 'supervisor', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentSubjectForSupervisors.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentBodyForSupervisors.txt'),
        (7, 2, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/assign/leaveAssignmentSubscriberBody.txt'),
        (8, 4, 'en_US', 'ess', 'supervisor', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveEmployeeCancellationSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveEmployeeCancellationBody.txt'),
        (9, 4, 'en_US', 'ess', 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveEmployeeCancellationSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveEmployeeCancellationSubscriberBody.txt'),
        (10, 4, 'en_US', NULL, 'ess', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveCancellationSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveCancellationBody.txt'),
        (11, 4, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveCancellationSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/cancel/leaveCancellationSubscriberBody.txt'),
        (12, 5, 'en_US', NULL, 'ess', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/reject/leaveRejectionSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/reject/leaveRejectionBody.txt'),
        (13, 5, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/reject/leaveRejectionSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/reject/leaveRejectionSubscriberBody.txt'),
        (14, 6, 'en_US', NULL, 'ess', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/change/leaveChangeSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/change/leaveChangeBody.txt'),
        (15, 6, 'en_US', NULL, 'subscriber', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/change/leaveChangeSubscriberSubject.txt', 'orangehrmLeavePlugin/modules/leave/templates/mail/en_US/change/leaveChangeSubscriberBody.txt');";

        $sql[] = "ALTER TABLE `ohrm_email_template`
          ADD CONSTRAINT `ohrm_email_template_ibfk_1` FOREIGN KEY (`email_id`) REFERENCES `ohrm_email` (`id`) ON DELETE CASCADE;";


        $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_status` (
                    `id` int(11) NOT NULL AUTO_INCREMENT,
                    `status` smallint(6) NOT NULL,
                    `name` varchar(100) NOT NULL,
                    PRIMARY KEY (`id`)
                  ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=8 ;";


      $sql[] = "INSERT INTO `ohrm_leave_status` (`id`, `status`, `name`) VALUES
                    (1, -1, 'REJECTED'),
                    (2, 0, 'CANCELLED'),
                    (3, 1, 'PENDING APPROVAL'),
                    (4, 2, 'SCHEDULED'),
                    (5, 3, 'TAKEN'),
                    (6, 4, 'WEEKEND'),
                    (7, 5, 'HOLIDAY');";

        /* straight forward new table creation & data insertion - by emma - ends*/

      
      
      
        /* straight forward data insertion, deletion to existing tables - by emma */

      //$sql[] = "DELETE FROM `ohrm_menu_item` WHERE `id`=47;";

      $sql[] = "INSERT INTO `hs_hr_config` (`key`, `value`) VALUES 
        ('leave.include_pending_leave_in_balance', '0'),
        ('leave.leavePeriodStatus', '1');";

      $sql[] = "DELETE FROM `ohrm_user_role_data_group`;";
      
      $sql[] = "DELETE FROM `ohrm_data_group`;";

//      $sql[] = "DELETE FROM `ohrm_user_role_data_group` WHERE id>=40;";
//      
//      $sql[] = "DELETE FROM `ohrm_data_group` WHERE `id`=40;";

      $sql[] = "INSERT INTO `ohrm_data_group` (`id`, `name`, `description`, `can_read`, `can_create`, `can_update`, `can_delete`) VALUES
            (1, 'personal_information', 'PIM - Personal Details', 1, NULL, 1, NULL),
            (2, 'personal_attachment', 'PIM - Personal Details - Attachments', 1, 1, 1, 1),
            (3, 'personal_custom_fields', 'PIM - Personal Details - Custom Fields', 1, NULL, 1, NULL),
            (4, 'contact_details', 'PIM - Contact Details', 1, NULL, 1, NULL),
            (5, 'contact_attachment', 'PIM - Contact Details - Attachments', 1, 1, 1, 1),
            (6, 'contact_custom_fields', 'PIM - Contact Details - Custom Fields', 1, NULL, 1, NULL),
            (7, 'emergency_contacts', 'PIM - Emergency Contacts', 1, 1, 1, 1),
            (8, 'emergency_attachment', 'PIM - Emergency Contacts - Attachments', 1, 1, 1, 1),
            (9, 'emergency_custom_fields', 'PIM - Emergency Contacts - Custom Fields', 1, NULL, 1, NULL),
            (10, 'dependents', 'PIM - Dependents', 1, 1, 1, 1),
            (11, 'dependents_attachment', 'PIM - Dependents - Attachments', 1, 1, 1, 1),
            (12, 'dependents_custom_fields', 'PIM - Dependents - Custom Fields', 1, NULL, 1, NULL),
            (13, 'immigration', 'PIM - Immigration', 1, 1, 1, 1),
            (14, 'immigration_attachment', 'PIM - Immigration - Attachments', 1, 1, 1, 1),
            (15, 'immigration_custom_fields', 'PIM - Immigration - Custom Fields', 1, NULL, 1, NULL),
            (16, 'job_details', 'PIM - Job', 1, NULL, 1, NULL),
            (17, 'job_attachment', 'PIM - Job - Attachments', 1, 1, 1, 1),
            (18, 'job_custom_fields', 'PIM - Job - Custom Fields', 1, NULL, 1, NULL),
            (19, 'salary_details', 'PIM - Salary', 1, 1, 1, 1),
            (20, 'salary_attachment', 'PIM - Salary - Attachments', 1, 1, 1, 1),
            (21, 'salary_custom_fields', 'PIM - Salary - Custom Fields', 1, NULL, 1, NULL),
            (22, 'tax_exemptions', 'PIM - Tax Exemptions', 1, NULL, 1, NULL),
            (23, 'tax_attachment', 'PIM - Tax Exemptions - Attachments', 1, 1, 1, 1),
            (24, 'tax_custom_fields', 'PIM - Tax Exemptions - Custom Fields', 1, NULL, 1, NULL),
            (25, 'supervisor', 'PIM - Employee Supervisors', 1, 1, 1, 1),
            (26, 'subordinates', 'PIM - Employee Subordinates', 1, 1, 1, 1),
            (27, 'report-to_attachment', 'PIM - Employee Supervisors/Subordinates - Attachment', 1, 1, 1, 1),
            (28, 'report-to_custom_fields', 'PIM - Employee Supervisors/Subordinates - Custom Fields', 1, NULL, 1, NULL),
            (29, 'qualification_work', 'PIM - Qualifications - Work Experience', 1, 1, 1, 1),
            (30, 'qualification_education', 'PIM - Qualifications - Education', 1, 1, 1, 1),
            (31, 'qualification_skills', 'PIM - Qualifications - Skills', 1, 1, 1, 1),
            (32, 'qualification_languages', 'PIM - Qualifications - Languages', 1, 1, 1, 1),
            (33, 'qualification_license', 'PIM - Qualifications - License', 1, 1, 1, 1),
            (34, 'qualifications_attachment', 'PIM - Qualifications - Attachments', 1, 1, 1, 1),
            (35, 'qualifications_custom_fields', 'PIM - Qualifications - Custom Fields', 1, NULL, 1, NULL),
            (36, 'membership', 'PIM - Membership', 1, 1, 1, 1),
            (37, 'membership_attachment', 'PIM - Membership - Attachments', 1, 1, 1, 1),
            (38, 'membership_custom_fields', 'PIM - Membership - Custom Fields', 1, NULL, 1, NULL),
            (39, 'photograph', 'PIM - Employee Photograph', 1, NULL, 1, 1),
            (40, 'leave_entitlements', 'Leave - Leave Entitlements', 1, 1, 1, 1),
            (41, 'leave_entitlements_usage_report', 'Leave - Leave Entitlements and Usage Report', 1, NULL, NULL, NULL);";

      $sql[] = "INSERT INTO `ohrm_user_role_data_group` (`id`, `user_role_id`, `data_group_id`, `can_read`, `can_create`, `can_update`, `can_delete`, `self`) VALUES
            (1, 1, 1, 1, NULL, 1, NULL, 0),
            (2, 1, 2, 1, 1, 1, 1, 0),
            (3, 1, 3, 1, NULL, 1, NULL, 0),
            (4, 1, 4, 1, NULL, 1, NULL, 0),
            (5, 1, 5, 1, 1, 1, 1, 0),
            (6, 1, 6, 1, NULL, 1, NULL, 0),
            (7, 1, 7, 1, 1, 1, 1, 0),
            (8, 1, 8, 1, 1, 1, 1, 0),
            (9, 1, 9, 1, NULL, 1, NULL, 0),
            (10, 1, 10, 1, 1, 1, 1, 0),
            (11, 1, 11, 1, 1, 1, 1, 0),
            (12, 1, 12, 1, NULL, 1, NULL, 0),
            (13, 1, 13, 1, 1, 1, 1, 0),
            (14, 1, 14, 1, 1, 1, 1, 0),
            (15, 1, 15, 1, NULL, 1, NULL, 0),
            (16, 1, 16, 1, NULL, 1, NULL, 0),
            (17, 1, 17, 1, 1, 1, 1, 0),
            (18, 1, 18, 1, NULL, 1, NULL, 0),
            (19, 1, 19, 1, 1, 1, 1, 0),
            (20, 1, 20, 1, 1, 1, 1, 0),
            (21, 1, 21, 1, NULL, 1, NULL, 0),
            (22, 1, 22, 1, NULL, 1, NULL, 0),
            (23, 1, 23, 1, 1, 1, 1, 0),
            (24, 1, 24, 1, NULL, 1, NULL, 0),
            (25, 1, 25, 1, 1, 1, 1, 0),
            (26, 1, 26, 1, 1, 1, 1, 0),
            (27, 1, 27, 1, 1, 1, 1, 0),
            (28, 1, 28, 1, NULL, 1, NULL, 0),
            (29, 1, 29, 1, 1, 1, 1, 0),
            (30, 1, 30, 1, 1, 1, 1, 0),
            (31, 1, 31, 1, 1, 1, 1, 0),
            (32, 1, 32, 1, 1, 1, 1, 0),
            (33, 1, 33, 1, 1, 1, 1, 0),
            (34, 1, 34, 1, 1, 1, 1, 0),
            (35, 1, 35, 1, NULL, 1, NULL, 0),
            (36, 1, 36, 1, 1, 1, 1, 0),
            (37, 1, 37, 1, 1, 1, 1, 0),
            (38, 1, 38, 1, NULL, 1, NULL, 0),
            (39, 1, 39, 1, NULL, 1, 1, 0),
            (40, 1, 40, 1, 1, 1, 1, 0),
            (41, 1, 41, 1, NULL, NULL, NULL, 0),
            (42, 1, 1, 1, NULL, 1, NULL, 1),
            (43, 1, 2, 1, 1, 1, 1, 1),
            (44, 1, 3, 1, NULL, 1, NULL, 1),
            (45, 1, 4, 1, NULL, 1, NULL, 1),
            (46, 1, 5, 1, 1, 1, 1, 1),
            (47, 1, 6, 1, NULL, 1, NULL, 1),
            (48, 1, 7, 1, 1, 1, 1, 1),
            (49, 1, 8, 1, 1, 1, 1, 1),
            (50, 1, 9, 1, NULL, 1, NULL, 1),
            (51, 1, 10, 1, 1, 1, 1, 1),
            (52, 1, 11, 1, 1, 1, 1, 1),
            (53, 1, 12, 1, NULL, 1, NULL, 1),
            (54, 1, 13, 1, 1, 1, 1, 1),
            (55, 1, 14, 1, 1, 1, 1, 1),
            (56, 1, 15, 1, NULL, 1, NULL, 1),
            (57, 1, 16, 1, NULL, NULL, NULL, 1),
            (58, 1, 17, 1, 0, 0, 0, 1),
            (59, 1, 18, 1, 0, 0, 0, 1),
            (60, 1, 19, 1, NULL, NULL, NULL, 1),
            (61, 1, 20, 1, 0, 0, 0, 1),
            (62, 1, 21, 1, 0, 0, 0, 1),
            (63, 1, 22, 1, NULL, NULL, NULL, 1),
            (64, 1, 23, 1, 0, 0, 0, 1),
            (65, 1, 24, 1, 0, 0, 0, 1),
            (66, 1, 25, 1, NULL, NULL, NULL, 1),
            (67, 1, 26, 1, NULL, NULL, NULL, 1),
            (68, 1, 27, 1, 0, 0, 0, 1),
            (69, 1, 28, 1, 0, 0, 0, 1),
            (70, 1, 29, 1, 1, 1, 1, 1),
            (71, 1, 30, 1, 1, 1, 1, 1),
            (72, 1, 31, 1, 1, 1, 1, 1),
            (73, 1, 32, 1, 1, 1, 1, 1),
            (74, 1, 33, 1, 1, 1, 1, 1),
            (75, 1, 34, 1, 1, 1, 1, 1),
            (76, 1, 35, 1, NULL, 1, NULL, 1),
            (77, 1, 36, 1, 1, 1, 1, 1),
            (78, 1, 37, 1, 1, 1, 1, 1),
            (79, 1, 38, 1, NULL, 1, NULL, 1),
            (80, 1, 39, 1, NULL, 1, 1, 1),
            (81, 1, 40, 1, 1, 1, 1, 1),
            (82, 1, 41, 1, NULL, NULL, NULL, 1),
            (83, 2, 1, 1, NULL, 1, NULL, 1),
            (84, 2, 2, 1, 1, 1, 1, 1),
            (85, 2, 3, 1, NULL, 1, NULL, 1),
            (86, 2, 4, 1, NULL, 1, NULL, 1),
            (87, 2, 5, 1, 1, 1, 1, 1),
            (88, 2, 6, 1, NULL, 1, NULL, 1),
            (89, 2, 7, 1, 1, 1, 1, 1),
            (90, 2, 8, 1, 1, 1, 1, 1),
            (91, 2, 9, 1, NULL, 1, NULL, 1),
            (92, 2, 10, 1, 1, 1, 1, 1),
            (93, 2, 11, 1, 1, 1, 1, 1),
            (94, 2, 12, 1, NULL, 1, NULL, 1),
            (95, 2, 13, 1, 1, 1, 1, 1),
            (96, 2, 14, 1, 1, 1, 1, 1),
            (97, 2, 15, 1, NULL, 1, NULL, 1),
            (98, 2, 16, 1, NULL, NULL, NULL, 1),
            (99, 2, 17, 1, 0, 0, 0, 1),
            (100, 2, 18, 1, 0, 0, 0, 1),
            (101, 2, 19, 1, NULL, NULL, NULL, 1),
            (102, 2, 20, 1, 0, 0, 0, 1),
            (103, 2, 21, 1, 0, 0, 0, 1),
            (104, 2, 22, 1, NULL, NULL, NULL, 1),
            (105, 2, 23, 1, 0, 0, 0, 1),
            (106, 2, 24, 1, 0, 0, 0, 1),
            (107, 2, 25, 1, NULL, NULL, NULL, 1),
            (108, 2, 26, 1, NULL, NULL, NULL, 1),
            (109, 2, 27, 1, 0, 0, 0, 1),
            (110, 2, 28, 1, 0, 0, 0, 1),
            (111, 2, 29, 1, 1, 1, 1, 1),
            (112, 2, 30, 1, 1, 1, 1, 1),
            (113, 2, 31, 1, 1, 1, 1, 1),
            (114, 2, 32, 1, 1, 1, 1, 1),
            (115, 2, 33, 1, 1, 1, 1, 1),
            (116, 2, 34, 1, 1, 1, 1, 1),
            (117, 2, 35, 1, NULL, 1, NULL, 1),
            (118, 2, 36, 1, 1, 1, 1, 1),
            (119, 2, 37, 1, 1, 1, 1, 1),
            (120, 2, 38, 1, NULL, 1, NULL, 1),
            (121, 2, 39, 1, NULL, 1, 1, 1),
            (122, 2, 40, 1, 0, 0, 0, 1),
            (123, 2, 41, 1, NULL, NULL, NULL, 1),
            (124, 3, 1, 1, NULL, 1, NULL, 0),
            (125, 3, 2, 1, 1, 1, 1, 0),
            (126, 3, 3, 1, NULL, 1, NULL, 0),
            (127, 3, 4, 1, NULL, 1, NULL, 0),
            (128, 3, 5, 1, 1, 1, 1, 0),
            (129, 3, 6, 1, NULL, 1, NULL, 0),
            (130, 3, 7, 1, 1, 1, 1, 0),
            (131, 3, 8, 1, 1, 1, 1, 0),
            (132, 3, 9, 1, NULL, 1, NULL, 0),
            (133, 3, 10, 1, 1, 1, 1, 0),
            (134, 3, 11, 1, 1, 1, 1, 0),
            (135, 3, 12, 1, NULL, 1, NULL, 0),
            (136, 3, 13, 1, 1, 1, 1, 0),
            (137, 3, 14, 1, 1, 1, 1, 0),
            (138, 3, 15, 1, NULL, 1, NULL, 0),
            (139, 3, 16, 1, NULL, NULL, NULL, 0),
            (140, 3, 17, 1, 0, 0, 0, 0),
            (141, 3, 18, 1, 0, 0, 0, 0),
            (142, 3, 19, 0, 0, 0, 0, 0),
            (143, 3, 20, 0, 0, 0, 0, 0),
            (144, 3, 21, 0, 0, 0, 0, 0),
            (145, 3, 22, 1, NULL, NULL, NULL, 0),
            (146, 3, 23, 1, 0, 0, 0, 0),
            (147, 3, 24, 1, 0, 0, 0, 0),
            (148, 3, 25, 1, NULL, NULL, NULL, 0),
            (149, 3, 26, 1, NULL, NULL, NULL, 0),
            (150, 3, 27, 1, 0, 0, 0, 0),
            (151, 3, 28, 1, 0, 0, 0, 0),
            (152, 3, 29, 1, 1, 1, 1, 0),
            (153, 3, 30, 1, 1, 1, 1, 0),
            (154, 3, 31, 1, 1, 1, 1, 0),
            (155, 3, 32, 1, 1, 1, 1, 0),
            (156, 3, 33, 1, 1, 1, 1, 0),
            (157, 3, 34, 1, 1, 1, 1, 0),
            (158, 3, 35, 1, NULL, 1, NULL, 0),
            (159, 3, 36, 1, 1, 1, 1, 0),
            (160, 3, 37, 1, 1, 1, 1, 0),
            (161, 3, 38, 1, NULL, 1, NULL, 0),
            (162, 3, 39, 1, NULL, 1, 1, 0),
            (163, 3, 40, 1, 0, 0, 0, 0),
            (164, 3, 41, 1, NULL, NULL, NULL, 0),
            (165, 3, 1, 1, NULL, 1, NULL, 1),
            (166, 3, 2, 1, 1, 1, 1, 1),
            (167, 3, 3, 1, NULL, 1, NULL, 1),
            (168, 3, 4, 1, NULL, 1, NULL, 1),
            (169, 3, 5, 1, 1, 1, 1, 1),
            (170, 3, 6, 1, NULL, 1, NULL, 1),
            (171, 3, 7, 1, 1, 1, 1, 1),
            (172, 3, 8, 1, 1, 1, 1, 1),
            (173, 3, 9, 1, NULL, 1, NULL, 1),
            (174, 3, 10, 1, 1, 1, 1, 1),
            (175, 3, 11, 1, 1, 1, 1, 1),
            (176, 3, 12, 1, NULL, 1, NULL, 1),
            (177, 3, 13, 1, 1, 1, 1, 1),
            (178, 3, 14, 1, 1, 1, 1, 1),
            (179, 3, 15, 1, NULL, 1, NULL, 1),
            (180, 3, 16, 1, NULL, NULL, NULL, 1),
            (181, 3, 17, 1, 0, 0, 0, 1),
            (182, 3, 18, 1, 0, 0, 0, 1),
            (183, 3, 19, 1, 0, 0, 0, 1),
            (184, 3, 20, 1, 0, 0, 0, 1),
            (185, 3, 21, 1, 0, 0, 0, 1),
            (186, 3, 22, 1, NULL, NULL, NULL, 1),
            (187, 3, 23, 1, 0, 0, 0, 1),
            (188, 3, 24, 1, 0, 0, 0, 1),
            (189, 3, 25, 1, NULL, NULL, NULL, 1),
            (190, 3, 26, 1, NULL, NULL, NULL, 1),
            (191, 3, 27, 1, 0, 0, 0, 1),
            (192, 3, 28, 1, 0, 0, 0, 1),
            (193, 3, 29, 1, 1, 1, 1, 1),
            (194, 3, 30, 1, 1, 1, 1, 1),
            (195, 3, 31, 1, 1, 1, 1, 1),
            (196, 3, 32, 1, 1, 1, 1, 1),
            (197, 3, 33, 1, 1, 1, 1, 1),
            (198, 3, 34, 1, 1, 1, 1, 1),
            (199, 3, 35, 1, NULL, 1, NULL, 1),
            (200, 3, 36, 1, 1, 1, 1, 1),
            (201, 3, 37, 1, 1, 1, 1, 1),
            (202, 3, 38, 1, NULL, 1, NULL, 1),
            (203, 3, 39, 1, NULL, 1, 1, 1),
            (204, 3, 40, 1, 0, 0, 0, 1),
            (205, 3, 41, 1, NULL, NULL, NULL, 1);";

      
            $sql[] = "DELETE FROM `ohrm_workflow_state_machine`;";

            $sql[] = "alter table `ohrm_workflow_state_machine` add column `roles_to_notify` text;";

            $sql[] = "alter table `ohrm_workflow_state_machine` add column `priority` int(11) NOT NULL DEFAULT '0' COMMENT 'lowest priority 0';";

            $sql[] = "INSERT INTO `ohrm_workflow_state_machine` (`id`, `workflow`, `state`, `role`, `action`, `resulting_state`, `roles_to_notify`, `priority`) VALUES
                (1, '0', 'INITIAL', 'SYSTEM', '7', 'NOT SUBMITTED', '', 0),
                (2, '0', 'SUBMITTED', 'ADMIN', '2', 'APPROVED', '', 0),
                (3, '0', 'SUBMITTED', 'ADMIN', '3', 'REJECTED', '', 0),
                (4, '0', 'SUBMITTED', 'ADMIN', '0', 'SUBMITTED', '', 0),
                (5, '0', 'SUBMITTED', 'ADMIN', '5', 'SUBMITTED', '', 0),
                (6, '0', 'SUBMITTED', 'SUPERVISOR', '2', 'APPROVED', '', 0),
                (7, '0', 'SUBMITTED', 'SUPERVISOR', '3', 'REJECTED', '', 0),
                (8, '0', 'SUBMITTED', 'SUPERVISOR', '5', 'SUBMITTED', '', 0),
                (9, '0', 'SUBMITTED', 'SUPERVISOR', '0', 'SUBMITTED', '', 0),
                (10, '0', 'SUBMITTED', 'ESS USER', '0', 'SUBMITTED', '', 0),
                (11, '0', 'SUBMITTED', 'ESS USER', '5', 'SUBMITTED', '', 0),
                (12, '0', 'NOT SUBMITTED', 'ESS USER', '1', 'SUBMITTED', '', 0),
                (13, '0', 'NOT SUBMITTED', 'ESS USER', '5', 'NOT SUBMITTED', '', 0),
                (14, '0', 'NOT SUBMITTED', 'ESS USER', '6', 'NOT SUBMITTED', '', 0),
                (15, '0', 'NOT SUBMITTED', 'ESS USER', '0', 'NOT SUBMITTED', '', 0),
                (16, '0', 'NOT SUBMITTED', 'SUPERVISOR', '0', 'NOT SUBMITTED', '', 0),
                (17, '0', 'NOT SUBMITTED', 'SUPERVISOR', '5', 'NOT SUBMITTED', '', 0),
                (18, '0', 'NOT SUBMITTED', 'SUPERVISOR', '1', 'SUBMITTED', '', 0),
                (19, '0', 'NOT SUBMITTED', 'ADMIN', '0', 'NOT SUBMITTED', '', 0),
                (20, '0', 'NOT SUBMITTED', 'ADMIN', '5', 'NOT SUBMITTED', '', 0),
                (21, '0', 'NOT SUBMITTED', 'ADMIN', '1', 'SUBMITTED', '', 0),
                (22, '0', 'REJECTED', 'ESS USER', '1', 'SUBMITTED', '', 0),
                (23, '0', 'REJECTED', 'ESS USER', '0', 'REJECTED', '', 0),
                (24, '0', 'REJECTED', 'ESS USER', '5', 'REJECTED', '', 0),
                (25, '0', 'REJECTED', 'SUPERVISOR', '1', 'SUBMITTED', '', 0),
                (26, '0', 'REJECTED', 'SUPERVISOR', '0', 'REJECTED', '', 0),
                (27, '0', 'REJECTED', 'SUPERVISOR', '5', 'REJECTED', '', 0),
                (28, '0', 'REJECTED', 'ADMIN', '0', 'REJECTED', '', 0),
                (29, '0', 'REJECTED', 'ADMIN', '5', 'SUBMITTED', '', 0),
                (30, '0', 'REJECTED', 'ADMIN', '1', 'SUBMITTED', '', 0),
                (31, '0', 'APPROVED', 'ESS USER', '0', 'APPROVED', '', 0),
                (32, '0', 'APPROVED', 'SUPERVISOR', '0', 'APPROVED', '', 0),
                (33, '0', 'APPROVED', 'ADMIN', '0', 'APPROVED', '', 0),
                (34, '0', 'APPROVED', 'ADMIN', '4', 'SUBMITTED', '', 0),
                (35, '1', 'PUNCHED IN', 'ESS USER', '1', 'PUNCHED OUT', '', 0),
                (36, '1', 'INITIAL', 'ESS USER', '0', 'PUNCHED IN', '', 0),
                (37, '2', 'INITIAL', 'ADMIN', '1', 'APPLICATION INITIATED', '', 0),
                (38, '2', 'APPLICATION INITIATED', 'ADMIN', '2', 'SHORTLISTED', '', 0),
                (39, '2', 'APPLICATION INITIATED', 'ADMIN', '3', 'REJECTED', '', 0),
                (40, '2', 'SHORTLISTED', 'ADMIN', '4', 'INTERVIEW SCHEDULED', '', 0),
                (41, '2', 'SHORTLISTED', 'ADMIN', '3', 'REJECTED', '', 0),
                (42, '2', 'INTERVIEW SCHEDULED', 'ADMIN', '3', 'REJECTED', '', 0),
                (43, '2', 'INTERVIEW SCHEDULED', 'ADMIN', '5', 'INTERVIEW PASSED', '', 0),
                (44, '2', 'INTERVIEW SCHEDULED', 'ADMIN', '6', 'INTERVIEW FAILED', '', 0),
                (45, '2', 'INTERVIEW PASSED', 'ADMIN', '4', 'INTERVIEW SCHEDULED', '', 0),
                (46, '2', 'INTERVIEW PASSED', 'ADMIN', '7', 'JOB OFFERED', '', 0),
                (47, '2', 'INTERVIEW PASSED', 'ADMIN', '3', 'REJECTED', '', 0),
                (48, '2', 'INTERVIEW FAILED', 'ADMIN', '3', 'REJECTED', '', 0),
                (49, '2', 'JOB OFFERED', 'ADMIN', '8', 'OFFER DECLINED', '', 0),
                (50, '2', 'JOB OFFERED', 'ADMIN', '3', 'REJECTED', '', 0),
                (51, '2', 'JOB OFFERED', 'ADMIN', '9', 'HIRED', '', 0),
                (52, '2', 'OFFER DECLINED', 'ADMIN', '3', 'REJECTED', '', 0),
                (53, '2', 'INITIAL', 'HIRING MANAGER', '1', 'APPLICATION INITIATED', '', 0),
                (54, '2', 'APPLICATION INITIATED', 'HIRING MANAGER', '2', 'SHORTLISTED', '', 0),
                (55, '2', 'APPLICATION INITIATED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (56, '2', 'SHORTLISTED', 'HIRING MANAGER', '4', 'INTERVIEW SCHEDULED', '', 0),
                (57, '2', 'SHORTLISTED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (58, '2', 'INTERVIEW SCHEDULED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (59, '2', 'INTERVIEW SCHEDULED', 'HIRING MANAGER', '5', 'INTERVIEW PASSED', '', 0),
                (60, '2', 'INTERVIEW SCHEDULED', 'HIRING MANAGER', '6', 'INTERVIEW FAILED', '', 0),
                (61, '2', 'INTERVIEW PASSED', 'HIRING MANAGER', '4', 'INTERVIEW SCHEDULED', '', 0),
                (62, '2', 'INTERVIEW PASSED', 'HIRING MANAGER', '7', 'JOB OFFERED', '', 0),
                (63, '2', 'INTERVIEW PASSED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (64, '2', 'INTERVIEW FAILED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (65, '2', 'JOB OFFERED', 'HIRING MANAGER', '8', 'OFFER DECLINED', '', 0),
                (66, '2', 'JOB OFFERED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (67, '2', 'JOB OFFERED', 'HIRING MANAGER', '9', 'HIRED', '', 0),
                (68, '2', 'OFFER DECLINED', 'HIRING MANAGER', '3', 'REJECTED', '', 0),
                (69, '2', 'INTERVIEW SCHEDULED', 'INTERVIEWER', '5', 'INTERVIEW PASSED', '', 0),
                (70, '2', 'INTERVIEW SCHEDULED', 'INTERVIEWER', '6', 'INTERVIEW FAILED', '', 0),
                (71, '1', 'INITIAL', 'ADMIN', '5', 'PUNCHED IN', '', 0),
                (72, '1', 'PUNCHED IN', 'ADMIN', '6', 'PUNCHED OUT', '', 0),
                (73, '1', 'PUNCHED IN', 'ADMIN', '2', 'PUNCHED IN', '', 0),
                (74, '1', 'PUNCHED IN', 'ADMIN', '7', 'N/A', '', 0),
                (75, '1', 'PUNCHED OUT', 'ADMIN', '2', 'PUNCHED OUT', '', 0),
                (76, '1', 'PUNCHED OUT', 'ADMIN', '3', 'PUNCHED OUT', '', 0),
                (77, '1', 'PUNCHED OUT', 'ADMIN', '7', 'N/A', '', 0),
                (78, '0', 'INITIAL', 'ADMIN', '7', 'NOT SUBMITTED', '', 0),
                (79, '0', 'INITIAL', 'ESS USER', '7', 'NOT SUBMITTED', '', 0),
                (80, '0', 'INITIAL', 'SUPERVISOR', '7', 'NOT SUBMITTED', '', 0),
                (81, '3', 'NOT_EXIST', 'ADMIN', '1', 'ACTIVE', '', 0),
                (82, '3', 'ACTIVE', 'ADMIN', '2', 'NOT_EXIST', '', 0),
                (83, '3', 'ACTIVE', 'ADMIN', '3', 'TERMINATED', '', 0),
                (84, '3', 'TERMINATED', 'ADMIN', '4', 'ACTIVE', '', 0),
                (85, '3', 'TERMINATED', 'ADMIN', '5', 'NOT_EXIST', '', 0),
                (86, '4', 'INITIAL', 'ESS', 'APPLY', 'PENDING APPROVAL', 'supervisor,subscriber', 0),
                (87, '4', 'INITIAL', 'ADMIN', 'ASSIGN', 'SCHEDULED', 'ess,supervisor,subscriber', 0),
                (88, '4', 'INITIAL', 'SUPERVISOR', 'ASSIGN', 'SCHEDULED', 'ess,supervisor,subscriber', 0),
                (89, '4', 'PENDING APPROVAL', 'ADMIN', 'APPROVE', 'SCHEDULED', 'ess,subscriber', 0),
                (90, '4', 'PENDING APPROVAL', 'SUPERVISOR', 'APPROVE', 'SCHEDULED', 'ess,subscriber', 0),
                (91, '4', 'PENDING APPROVAL', 'ESS', 'CANCEL', 'CANCELLED', 'supervisor,subscriber', 0),
                (92, '4', 'PENDING APPROVAL', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (93, '4', 'PENDING APPROVAL', 'SUPERVISOR', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (94, '4', 'PENDING APPROVAL', 'ADMIN', 'REJECT', 'REJECTED', 'ess,subscriber', 0),
                (95, '4', 'PENDING APPROVAL', 'SUPERVISOR', 'REJECT', 'REJECTED', 'ess,subscriber', 0),
                (96, '4', 'SCHEDULED', 'ESS', 'CANCEL', 'CANCELLED', 'supervisor,subscriber', 0),
                (97, '4', 'SCHEDULED', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (98, '4', 'SCHEDULED', 'SUPERVISOR', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (99, '4', 'TAKEN', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (100, '4', 'LEAVE TYPE DELETED PENDING APPROVAL', 'ESS', 'CANCEL', 'CANCELLED', 'supervisor,subscriber', 0),
                (101, '4', 'LEAVE TYPE DELETED PENDING APPROVAL', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (102, '4', 'LEAVE TYPE DELETED PENDING APPROVAL', 'SUPERVISOR', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (103, '4', 'LEAVE TYPE DELETED SCHEDULED', 'ESS', 'CANCEL', 'CANCELLED', 'supervisor,subscriber', 0),
                (104, '4', 'LEAVE TYPE DELETED SCHEDULED', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (105, '4', 'LEAVE TYPE DELETED SCHEDULED', 'SUPERVISOR', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0),
                (106, '4', 'LEAVE TYPE DELETED TAKEN', 'ADMIN', 'CANCEL', 'CANCELLED', 'ess,subscriber', 0);";
            
            /* specific to internal upgrader */
            /* TODO: must check whether time module is defined, if so enbale below */
            $sql[] = "UPDATE `ohrm_menu_item` SET `status` = 1 WHERE `id` >= 52 AND `id` <= 64;";
            
            /* TODO: must check whether leave module is defined, if so enbale below */
            $sql[] = "UPDATE `ohrm_menu_item` SET `status` = 1 WHERE `id` = 74;";
            $sql[] = "UPDATE `ohrm_menu_item` SET `status` = 1 WHERE `id` >= 42 AND `id` <= 51;";
            
            $sql[] = "UPDATE `ohrm_menu_item` SET `menu_title` = 'User Management', `screen_id`=NULL WHERE `id` = 2;";

            $sql[] = "UPDATE `ohrm_menu_item` SET `parent_id` = 52, `order_hint`=400, `status`=1 WHERE `id` = 3;";
            
            /* specific to internal upgrader - ends */
            
        /* straight forward data insertion to existing tables - by emma - ends*/

      
        /* leave related changes - by emma*/
      $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_request_comment` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `leave_request_id` int(10) unsigned NOT NULL,
        `created` datetime DEFAULT NULL,
        `created_by_name` varchar(255) NOT NULL,
        `created_by_id` int(10) DEFAULT NULL,
        `created_by_emp_number` int(7) DEFAULT NULL,
        `comments` varchar(255) DEFAULT NULL,
        PRIMARY KEY (`id`),
        KEY `leave_request_id` (`leave_request_id`),
        KEY `created_by_id` (`created_by_id`),
        KEY `created_by_emp_number` (`created_by_emp_number`)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";

      $sql[] = "ALTER TABLE `ohrm_leave_request_comment`
        ADD CONSTRAINT `ohrm_leave_request_comment_ibfk_3` FOREIGN KEY (`created_by_emp_number`) REFERENCES `hs_hr_employee` (`emp_number`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_request_comment_ibfk_1` FOREIGN KEY (`leave_request_id`) REFERENCES `ohrm_leave_request` (`id`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_request_comment_ibfk_2` FOREIGN KEY (`created_by_id`) REFERENCES `ohrm_user` (`id`) ON DELETE SET NULL;";

      
      $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_adjustment` (
        `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
        `emp_number` int(7) NOT NULL,
        `no_of_days` decimal(6,2) NOT NULL,
        `leave_type_id` int(10) unsigned NOT NULL,
        `from_date` datetime DEFAULT NULL,
        `to_date` datetime DEFAULT NULL,
        `credited_date` datetime DEFAULT NULL,
        `note` varchar(255) DEFAULT NULL,
        `adjustment_type` int(10) unsigned NOT NULL DEFAULT '0',
        `deleted` tinyint(1) NOT NULL DEFAULT '0',
        `created_by_id` int(10) DEFAULT NULL,
        `created_by_name` varchar(255) DEFAULT NULL,
        PRIMARY KEY (`id`),
        KEY `leave_type_id` (`leave_type_id`),
        KEY `emp_number` (`emp_number`),
        KEY `created_by_id` (`created_by_id`),
        KEY `adjustment_type` (`adjustment_type`)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";

      $sql[] = "ALTER TABLE `ohrm_leave_adjustment`
        ADD CONSTRAINT `ohrm_leave_adjustment_ibfk_4` FOREIGN KEY (`adjustment_type`) REFERENCES `ohrm_leave_entitlement_type` (`id`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_adjustment_ibfk_1` FOREIGN KEY (`leave_type_id`) REFERENCES `ohrm_leave_type` (`id`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_adjustment_ibfk_2` FOREIGN KEY (`emp_number`) REFERENCES `hs_hr_employee` (`emp_number`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_adjustment_ibfk_3` FOREIGN KEY (`created_by_id`) REFERENCES `ohrm_user` (`id`) ON DELETE SET NULL;";

      $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_entitlement_adjustment` (
            `id` int(11) NOT NULL AUTO_INCREMENT,
            `adjustment_id` int(10) unsigned NOT NULL,
            `entitlement_id` int(10) unsigned NOT NULL,
            `length_days` decimal(4,2) unsigned DEFAULT NULL,
            PRIMARY KEY (`id`),
            KEY `entitlement_id` (`entitlement_id`),
            KEY `adjustment_id` (`adjustment_id`)
          ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";


      $sql[] = "ALTER TABLE `ohrm_leave_entitlement_adjustment`
            ADD CONSTRAINT `ohrm_leave_entitlement_adjustment_ibfk_1` FOREIGN KEY (`entitlement_id`) REFERENCES `ohrm_leave_entitlement` (`id`) ON DELETE CASCADE,
            ADD CONSTRAINT `ohrm_leave_entitlement_adjustment_ibfk_2` FOREIGN KEY (`adjustment_id`) REFERENCES `ohrm_leave_adjustment` (`id`) ON DELETE CASCADE;";

      
      $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_comment` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `leave_id` int(11) NOT NULL,
        `created` datetime DEFAULT NULL,
        `created_by_name` varchar(255) NOT NULL,
        `created_by_id` int(10) DEFAULT NULL,
        `created_by_emp_number` int(7) DEFAULT NULL,
        `comments` varchar(255) DEFAULT NULL,
        PRIMARY KEY (`id`),
        KEY `leave_id` (`leave_id`),
        KEY `created_by_id` (`created_by_id`),
        KEY `created_by_emp_number` (`created_by_emp_number`)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;";

      $sql[] = "ALTER TABLE `ohrm_leave_comment`
        ADD CONSTRAINT `ohrm_leave_comment_ibfk_3` FOREIGN KEY (`created_by_emp_number`) REFERENCES `hs_hr_employee` (`emp_number`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_comment_ibfk_1` FOREIGN KEY (`leave_id`) REFERENCES `ohrm_leave` (`id`) ON DELETE CASCADE,
        ADD CONSTRAINT `ohrm_leave_comment_ibfk_2` FOREIGN KEY (`created_by_id`) REFERENCES `ohrm_user` (`id`) ON DELETE SET NULL;";


      $sql[] = "CREATE TABLE IF NOT EXISTS `ohrm_leave_period_history` (
        `id` int(11) NOT NULL AUTO_INCREMENT,
        `leave_period_start_month` int(11) NOT NULL,
        `leave_period_start_day` int(11) NOT NULL,
        `created_at` date NOT NULL,
        PRIMARY KEY (`id`)
      ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;";


      /* insert data to ohrm_leave_period_history*/
      $sql[] = "INSERT INTO `ohrm_leave_period_history` (`id`, `leave_period_start_month`, `leave_period_start_day`, `created_at` )
                            SELECT old_lp.`leave_period_id`, MONTH(old_lp.`leave_period_start_date`), DAY(old_lp.`leave_period_start_date`), CONCAT(YEAR(old_lp.`leave_period_start_date`), '-01-01')
                            FROM `ohrm_leave_period` old_lp;";
      
      /* insert data to ohrm_leave_request */
      $sql[] = "INSERT INTO `ohrm_leave_request` (`id`, `leave_type_id`, `date_applied`, `emp_number`, `comments`)
		SELECT old_lr.`leave_request_id`, (SELECT old_lt.int_id FROM `hs_hr_leavetype` old_lt WHERE old_lt.leave_type_id = old_lr.leave_type_id), old_lr.`date_applied`, old_lr.`employee_id`, old_lr.`leave_comments` FROM  hs_hr_leave_requests old_lr;";

      
      $sql[] = "alter table `ohrm_leave_type` add column `exclude_in_reports_if_no_entitlement` tinyint(1) NOT NULL DEFAULT '0' AFTER `deleted`;";

      
      
      
      $sql[] = "SET foreign_key_checks = 0;";

        $sql[] = "UPDATE `hs_hr_employee_leave_quota` lq SET lq.`leave_type_id` = (SELECT lt.`int_id` FROM `hs_hr_leavetype` lt WHERE lt.`leave_type_id` = lq.`leave_type_id`);";
 
        //$sql[] = "alter table `hs_hr_employee_leave_quota` add column new_leave_start_date date not null;";
        //$sql[] = "alter table `hs_hr_employee_leave_quota` add column new_leave_end_date date not null;";

//$sql[] = "UPDATE `hs_hr_employee_leave_quota` lq SET lq.new_leave_start_date = (SELECT olp.leave_period_start_date FROM ohrm_leave_period olp WHERE olp.leave_period_id = lq.leave_period_id), lq.new_leave_end_date = (SELECT olp.leave_period_end_date FROM ohrm_leave_period olp WHERE olp.leave_period_id = lq.leave_period_id);";

//taking leave_taken is NOT correct, should take SUM(leave_length_days) 
//$sql[] = "UPDATE `ohrm_leave_entitlement` le SET le.`days_used` = (SELECT old_lq.`leave_taken` FROM `hs_hr_employee_leave_quota` old_lq WHERE old_lq.`employee_id` = le.`emp_number` AND old_lq.`leave_type_id` = le.leave_type_id AND old_lq.new_leave_start_date = DATE(le.from_date) AND old_lq.new_leave_end_date = DATE(le.to_date));";



    $sql[] = "UPDATE `hs_hr_leave` lq SET lq.`leave_type_id` = (SELECT lt.`int_id` FROM `hs_hr_leavetype` lt WHERE lt.leave_type_id = lq.leave_type_id);";


    //$sql[] = "alter table `hs_hr_leave` add column int_leave_type_id int not null;";


    $sql[] = "INSERT INTO `ohrm_leave` (`id`, `date`, `length_hours`, `length_days`, `status`, `comments`, `leave_request_id`, `leave_type_id`, `emp_number`, `start_time`, `end_time`) 
    SELECT old_l.leave_id, old_l.leave_date, old_l.leave_length_hours, old_l.leave_length_days, old_l.leave_status, old_l.leave_comments, old_l.leave_request_id, old_l.`leave_type_id`, old_l.employee_id, old_l.`start_time`, old_l.`end_time` FROM `hs_hr_leave` old_l;";

    //newly added - must be changed again, days used must be updated
    $sql[] = "UPDATE `ohrm_leave_entitlement` le SET le.`days_used` = (SELECT SUM(l.`length_days`) FROM `ohrm_leave` l WHERE l.`emp_number` = le.`emp_number` AND l.`leave_type_id` = le.leave_type_id AND l.date BETWEEN le.from_date AND le.to_date);";


    $sql[] = "alter table `ohrm_leave` add column new_entitlement_id int not null;";

    //this is incorrect
    //$sql[] = "UPDATE `ohrm_leave` l SET l.`new_entitlement_id` = (SELECT lp.leave_period_id FROM ohrm_leave_period lp WHERE l.date BETWEEN lp.leave_period_start_date AND lp.leave_period_end_date);";

    //$sql[] = "UPDATE `ohrm_leave` l SET l.`new_entitlement_id` = (SELECT le.id FROM ohrm_leave_entitlement le WHERE le.emp_number = l.emp_number AND le.leave_type_id = l.leave_type_id  AND (l.date BETWEEN le.from_date AND le.to_date));";
    $sql[] = "UPDATE `ohrm_leave` l SET l.`new_entitlement_id` = (SELECT le.id FROM ohrm_leave_entitlement le WHERE le.emp_number = l.emp_number AND le.leave_type_id = l.leave_type_id  AND (l.date >= le.from_date AND l.date <= le.to_date));";

    
    //instead of inserting from here, insert from the php script
    //$sql[] = "INSERT INTO `ohrm_leave_leave_entitlement` (`leave_id`, `entitlement_id`, `length_days`) 
    //SELECT l.`id`, l.`new_entitlement_id`, l.length_days FROM `ohrm_leave` l WHERE l.status<>4 AND l.status<>5;";

    //add leave request comments
    $sql[] = "INSERT INTO `ohrm_leave_request_comment` (`leave_request_id`, `created`, `created_by_name`, `created_by_id`, `created_by_emp_number`, `comments`)
    SELECT l.`id`, now(), 'record created by upgrade', 1, (SELECT u.`emp_number` FROM `ohrm_user` u WHERE u.`id` = 1), l.`comments` FROM `ohrm_leave_request` l;";

    //add leave comments
    $sql[] = "INSERT INTO `ohrm_leave_comment` (`leave_id`, `created`, `created_by_name`, `created_by_id`, `created_by_emp_number`, `comments`)
SELECT l.`id`, now(), 'record created by upgrade', 1, (SELECT u.`emp_number` FROM `ohrm_user` u WHERE u.`id` = 1), l.`comments` FROM `ohrm_leave` l;";
    
    //Update Time (hours) to Time (Hours) - labels should be consistent for gettin the total
    $sql[] = "UPDATE `ohrm_summary_display_field` SET `label` = 'Time (Hours)' WHERE `summary_display_field_id` = 2;";

    $sql[] = "alter table `hs_hr_leavetype` drop column int_id;";


    $sql[] = "DROP TABLE `hs_hr_employee_leave_quota`;";
    $sql[] = "DROP TABLE `hs_hr_empreport`;";
    $sql[] = "DROP TABLE `hs_hr_emprep_usergroup`;";
    $sql[] = "DROP TABLE `hs_hr_hsp`;";
    $sql[] = "DROP TABLE `hs_hr_hsp_payment_request`;";
    $sql[] = "DROP TABLE `hs_hr_hsp_summary`;";
    $sql[] = "DROP TABLE `hs_hr_leave`;";
    $sql[] = "DROP TABLE `hs_hr_leavetype`;";
    $sql[] = "DROP TABLE `hs_hr_leave_period`;";
    $sql[] = "DROP TABLE `hs_hr_leave_requests`;";
    $sql[] = "DROP TABLE `hs_hr_rights`;";
    $sql[] = "DROP TABLE `hs_hr_user_group`;";
    $sql[] = "DROP TABLE `ohrm_leave_period`;";

    $sql[] = "SET foreign_key_checks = 1;";

        /*$sql[] = "DELIMITER $$";
        $sql[] = "CREATE EVENT `leave_taken_status_change` ON SCHEDULE EVERY 1 HOUR STARTS '2013-02-13 00:00:00' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
                        UPDATE hs_hr_leave SET leave_status = 3 WHERE leave_status = 2 AND leave_date < DATE(NOW());
                      END$$";

        $sql[] = "DELIMITER ;";*/
        
        
        
        
        
        
        $this->sql = $sql;
    }

    public function getNotes() {
        return array();
    }
}

